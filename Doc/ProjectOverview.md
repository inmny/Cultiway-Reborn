# 修仙[Reborn] 项目总览与开发计划

**版本**: v0.0.24  
**状态**: 预览版（Alpha）  
**最后更新**: 2025年11月25日

---

## 📋 目录

1. [项目简介](#项目简介)
2. [技术架构](#技术架构)
3. [已完成功能](#已完成功能)
4. [开发进度分析](#开发进度分析)
5. [当前问题与限制](#当前问题与限制)
6. [后续开发计划](#后续开发计划)
7. [优先级任务清单](#优先级任务清单)

---

## 项目简介

修仙[Reborn]是一个为WorldBox游戏开发的大型修仙题材模组，基于NeoModLoader框架构建。该项目采用现代化的ECS（Entity Component System）架构，实现了一套完整的修仙体系，包括境界晋升、技能系统、丹药炼制、宗门管理等核心玩法。

### 核心设计理念
- **数据驱动**: 通过CSV/JSON配置文件管理游戏内容
- **模块化架构**: 清晰的代码组织，高内聚低耦合
- **AI自主行为**: NPC能够自主修炼、炼丹、学习技能
- **可扩展性**: 预留充足的扩展接口，便于添加新内容

---

## 技术架构

### 核心技术栈
```
├── 框架: .NET Framework 4.8 (C# 12)
├── ECS引擎: Friflo.Engine.ECS (多线程并行)
├── 补丁框架: Harmony 2.x
├── 数值计算: MathNet.Numerics
└── 模组加载: NeoModLoader
```

### 项目结构

```
Cultiway/
├── Source/                          # 源代码目录
│   ├── Core/                        # 核心系统
│   │   ├── Components/              # ECS组件定义
│   │   ├── Systems/                 # ECS系统（逻辑/渲染）
│   │   ├── Libraries/               # 资源库管理
│   │   ├── SkillLibV3/              # 技能系统V3
│   │   ├── GeoLib/                  # 地形演化系统
│   │   ├── EventSystem/             # 事件系统
│   │   └── AIGCLib/                 # AI生成内容库
│   │
│   ├── Content/                     # 游戏内容
│   │   ├── Components/              # 修仙相关组件
│   │   │   ├── Xian.cs             # 修仙境界
│   │   │   ├── Jindan.cs           # 金丹
│   │   │   ├── Yuanying.cs         # 元婴
│   │   │   ├── Elixir.cs           # 丹药
│   │   │   ├── Talisman.cs         # 符箓
│   │   │   └── Skill/              # 技能组件(26个文件)
│   │   ├── Behaviours/              # AI行为树
│   │   ├── Libraries/               # 内容资源库
│   │   ├── Systems/                 # 内容系统
│   │   ├── AIGC/                    # AI生成器
│   │   └── Extensions/              # 扩展工具
│   │
│   ├── Patch/                       # Harmony补丁
│   ├── UI/                          # 用户界面
│   ├── Utils/                       # 工具类(32个文件)
│   ├── Const/                       # 常量定义(13个文件)
│   └── LocaleKeys/                  # 本地化键值
│
├── Content/                         # 数据内容
│   ├── Cultisys/Xian.csv           # 修仙境界配置
│   ├── Skills/ProjectionSkills.json # 技能配置
│   └── PreparedLLMResults/          # AI预生成内容
│
├── Locales/                         # 多语言文本
│   ├── actors.csv                   # 生物本地化
│   ├── skills.csv                   # 技能本地化
│   ├── elixirs.csv                  # 丹药本地化
│   └── cultisys/xian.csv           # 修仙系统本地化
│
├── GameResources/                   # 游戏资源
│   ├── cultiway/                    # 模组资源
│   │   ├── icons/                  # 图标(150个)
│   │   ├── effect/                 # 特效(102个)
│   │   └── special_effects/        # 特殊效果
│   ├── actors/species/             # 生物贴图(2195个)
│   ├── buildings/                  # 建筑资源
│   └── sects/                      # 宗门资源
│
├── Scripts/                         # 工具脚本
│   ├── csv2json.py                 # 数据转换
│   ├── er_simulator.py             # 灵根模拟器
│   └── count_source_lines.py       # 代码统计
│
└── Doc/                            # 项目文档
    ├── ProjectOverview.md          # 项目总览（本文档）
    ├── CultibookSystem.md          # 功法系统设计
    ├── ModifierEffects.md          # 词条效果设计
    ├── SpellAffixDesign.md         # 法术词条系统
    └── SkillV2.md                  # 技能系统设计
```

### ECS架构

项目使用`Friflo.Engine.ECS`实现高性能的实体组件系统：

**核心系统层级**:
```
EntityStore (世界)
├── GeneralLogicSystems              # 通用逻辑系统根
│   ├── AnimFrameUpdateSystem        # 动画帧更新
│   ├── AliveTimerSystem             # 生命计时
│   ├── StatusTickSystem             # 状态效果更新
│   ├── LogicPrepareRecycleSystemGroup  # 回收准备组
│   │   ├── DisposeActorExtendSystem
│   │   ├── RecycleStatusEffectSystem
│   │   └── RecycleUnknownAssetsSystem
│   ├── LogicRestoreStatusSystemGroup   # 状态恢复组
│   │   ├── RestoreHealthSystem
│   │   └── RestoreQiyunSystem
│   └── LogicEventProcessSystemGroup    # 事件处理组
│
├── GeneralRenderSystems             # 通用渲染系统根
│   └── RenderAnimFrameSystem        # 动画帧渲染
│
├── TileLogicSystems                 # 地块逻辑系统根
│   ├── WakanSpreadSystem            # 灵气扩散
│   └── DirtyWakanSpreadSystem       # 浊气扩散
│
├── TileRenderSystems                # 地块渲染系统根
│
└── SkillLibV3                       # 技能系统
    ├── LogicTrajectorySystem        # 弹道逻辑
    └── LogicActorCollisionSystem    # 碰撞检测
```

**扩展管理器**:
- `ActorExtendManager`: 管理生物的ECS扩展数据
- `BookExtendManager`: 管理书籍的ECS扩展数据
- `CityExtendManager`: 管理城市的ECS扩展数据
- `TileExtendManager`: 管理地块的ECS扩展数据

---

## 已完成功能

### ✅ 修仙体系 (Cultisys)

**境界系统**:
- [x] 灵根生成与分类（金木水火土五行灵根）
- [x] 练气境界（基础修炼）
- [x] 筑基境界（腾云飞行能力）
- [x] 金丹境界（多种金丹类型，stage进阶）
- [x] 元婴境界（多种元婴类型，stage进阶）
- [x] 境界晋升逻辑与条件判定

**修炼系统**:
- [x] 灵气地图（WakanMap）及可视化
- [x] 浊气系统（DirtyWakanMap）与扩散
- [x] 自主吸收灵气修炼
- [x] 精气神三花系统
- [x] 五气朝元系统
- [x] 修炼速度受灵根影响

**数据结构**:
```csharp
XianBase {
    精(jing), 气(qi), 神(shen),     // 三花
    金(iron), 木(wood), 水(water),   // 五气
    火(fire), 土(earth)
}

Xian {
    level,      // 境界等级
    wakan       // 当前灵力
}

Jindan {
    jindan_type,  // 金丹类型
    strength,     // 强度
    stage         // 阶段
}

Yuanying {
    yuanying_type,  // 元婴类型
    strength,       // 强度
    stage           // 阶段
}
```

### ✅ 技能系统 (SkillLibV3)

**框架**:
- [x] 技能实体系统（SkillEntityAsset）
- [x] 技能容器（SkillContainer）
- [x] 技能上下文（SkillContext）
- [x] 技能词条系统（SkillModifier）
- [x] 弹道系统（Trajectory）
- [x] 碰撞检测（ColliderSphere）

**已实现技能类型**:
- [x] 御器系列法术（飞剑、法宝投掷）
- [x] 攻击法术自动释放
- [x] 法术学习框架

- **已实现词条** (Modifiers):
  - [x] 减速 (Slow)
  - [x] 强化 (Empower)
  - [x] 剧毒 (Poison)
  - [x] 灼烧 (Burn)
  - [x] 巨大 (Huge)
  - [x] 击飞 (Knockback)
  - [x] 冰冻 (Freeze)
  - [x] 爆炸 (Explosion)
  - [x] 衰弱 (Weaken)
  - [x] 破甲 (ArmorBreak)
  - [x] 引力 (Gravity) ※特效待补

**待实现词条** (见ModifierEffects.md):
- [ ] 急速 (Haste)
- [ ] 熟练 (Proficiency)
- [ ] 懵逼 (Daze)
- [ ] 怜悯 (Mercy)
- [ ] 混乱 (Chaos)
- [ ] 颠倒 (Swap)
- [ ] 随机 (Random Affix)
- [ ] 燃尽 (Burnout)
- [ ] 合击 (Combo)
- [ ] 封印 (Silence)
- [ ] 终焉死亡 (Death Sentence)
- [ ] 轮回试练 (Reincarnation Trial)
- [ ] 永世诅咒 (Eternal Curse)

### ✅ 物品系统

**材料框架**:
- [x] 物品形状系统（ItemShape）
- [x] 物品等级系统（ItemLevel）
- [x] 物品图标生成（ItemIconGenerator）
- [x] 物品名称系统（EntityName）
- [x] 特殊物品标记（SpecialItem）

**丹药系统**:
- [x] 丹药配方系统（ElixirAsset）
- [x] 丹药效果类型：
  - 恢复型 (Restore)
  - 数据变更型 (DataChange)
  - 状态获得型 (StatusGain)
  - 数据增益型 (DataGain)
- [x] 自主炼制丹药（AI行为）
- [x] 自主服用丹药（AI行为）
- [x] 自主创造丹药配方（AI行为）
- [x] 丹药配方书（Elixirbook）
- [x] AI生成丹药名称（LLM辅助）
- [x] AI生成丹药效果（LLM辅助）

**符箓系统**:
- [x] 符箓组件（Talisman）
- [x] 符箓名称生成（AI辅助）
- [x] 符箓制作行为（BehCraftTalisman）

**灵草系统**:
- [x] 灵草生成
- [x] 灵草转换浊气
- [x] 灵草名称生成（AI辅助）
- [x] 灵草采集行为（BehHarvestHerb）

### ✅ AI行为系统

**修炼相关**:
- [x] BehXianCultivate - 自主修炼
- [x] BehXianLevelup - 自主突破
- [x] BehPlantXianCultivate - 植物修炼
- [x] BehPlantXianLevelup - 植物突破

**炼丹相关**:
- [x] BehFindElixirToCraft - 寻找可炼制的丹药
- [x] BehCraftElixir - 炼制丹药
- [x] BehFindNewElixir - 发现新丹药配方

**学习相关**:
- [x] BehWriteElixirRecipe - 编写丹方
- [x] BehWriteSkillbook - 编写技能书
- [x] BehCreateCultibook - 创建修炼功法书
- [x] BehWriteCultibook - 编写功法

**宗门相关**:
- [x] BehBuildSect - 创建宗门

**其他**:
- [x] BehHoldSimpleCeremony - 举行仪式
- [x] BehCallSourceSpawner - 召唤源生成器
- [x] BehFindTargetForCollector - 采集目标寻找

### ✅ 宗门系统 (Sect)

**核心功能**:
- [x] 宗门创建（创始人系统）
- [x] 宗门数据存储（SectData）
- [x] 宗门管理器（SectManager）
- [x] 宗门旗帜系统（SectBanner）
- [x] 旗帜背景库（8个背景）
- [x] 旗帜图标库（5个图标）
- [x] 成员管理（listUnit）

**数据结构**:
```csharp
SectData {
    FounderActorName,        // 创始人名称
    FounderActorID,          // 创始人ID
    BannerBackgroundIndex,   // 旗帜背景索引
    BannerIconIndex          // 旗帜图标索引
}
```

### ✅ 书籍系统

**书籍类型**:
- [x] 修炼功法书（Cultibook）
- [x] 技能书（Skillbook）
- [x] 丹方书（Elixirbook）

**功能**:
- [x] 书籍创建与编写
- [x] 师承关系（CultibookMasterRelation）
- [x] 书籍传承系统

### ✅ 生物扩展

**新增种族**:
- [x] 东方人类（EasternHuman）
- [x] 明族（Ming）
- [x] 幻想生物（FantasyCreature）
- [x] 束灵（ConstraintSpirit）

**生物资源**:
- 2195个物种贴图
- 93个物种配置
- 自定义生物皮肤系统

### ✅ 建筑系统

**建筑类型**:
- [x] 修仙相关建筑（96个主建筑贴图）
- [x] 生物建筑（119个贴图）
- [x] 高级单位生成器（AdvancedUnitSpawner）

### ✅ 地形系统 (GeoLib)

**地形演化**:
- [x] 侵蚀系统（ErosionSystem）
- [x] 反侵蚀系统（AntiErosionSystem）
- [x] 河流追踪系统（RiverTrackSystem）

### ✅ UI系统

**主要界面**:
- [x] 世界灵气地图窗口（WindowWorldWakan）
- [x] 生物信息页面（7个CreatureInfoPages）
- [x] 自定义地图模式

### ✅ AIGC内容生成

**AI生成器**:
- [x] 生物名称生成器（ActorNameGenerator）
- [x] 技能名称生成器（SkillNameGenerator）
- [x] 丹药名称生成器（ElixirNameGenerator）
- [x] 丹药效果生成器（ElixirEffectJsonGenerator）
- [x] 灵草名称生成器（PlantNameGenerator）
- [x] 符箓名称生成器（TalismanNameGenerator）
- [x] 材料形状生成器（IngredientShapeGenerator）
- [x] 图片模板生成器（TemplateBasedImageGenerator）

**预生成内容**:
- ElixirEffectJsonDict.json
- ElixirNameDict.json
- IngredientNameDict.json
- PlantNameDict.json
- TalismanNameDict.json

### ✅ 数据与配置

**本地化**:
- [x] 15个本地化文件（CSV格式）
- [x] 动态文本更新系统
- [x] 下划线命名兼容

**配置系统**:
- [x] 修仙境界配置（Cultisys/Xian.csv）
- [x] 技能配置（Skills/ProjectionSkills.json）
- [x] 默认配置（default_config.json）

---

## 开发进度分析

### 完成度评估

```
修仙核心体系:        ████████████████████░░░░ 80%
├─ 境界系统:         ████████████████████████ 100%
├─ 灵根系统:         ████████████████████████ 100%
├─ 修炼逻辑:         ███████████████████░░░░░ 75%
└─ 飞行系统:         ████████████████████████ 100%

物品与丹药系统:      █████████████████████░░░ 85%
├─ 丹药配方:         ████████████████████████ 100%
├─ 炼制逻辑:         ████████████████████████ 100%
├─ 自动炼丹:         ████████████████████████ 100%
├─ 符箓系统:         ██████████████░░░░░░░░░░ 60%
└─ 炼器系统:         ░░░░░░░░░░░░░░░░░░░░░░░░ 0%

技能系统:            █████████████████░░░░░░░ 70%
├─ 技能框架:         ████████████████████████ 100%
├─ 御器法术:         ████████████████████████ 100%
├─ 五行法术:         ░░░░░░░░░░░░░░░░░░░░░░░░ 0%
├─ 词条系统:         ███████████████░░░░░░░░ 65%
└─ 自动释放:         ████████████████░░░░░░░░ 70%

宗门系统:            ███████░░░░░░░░░░░░░░░░░ 30%
├─ 基础框架:         ████████████████████████ 100%
├─ 成员管理:         ██████████░░░░░░░░░░░░░░ 40%
├─ 宗门关系:         ░░░░░░░░░░░░░░░░░░░░░░░░ 0%
└─ 宗门任务:         ░░░░░░░░░░░░░░░░░░░░░░░░ 0%

AI与内容生成:        ████████████████████░░░░ 80%
├─ 名称生成:         ████████████████████████ 100%
├─ 效果生成:         ████████████████░░░░░░░░ 70%
└─ 图像生成:         ███████████████░░░░░░░░░ 60%

功法系统:            ██░░░░░░░░░░░░░░░░░░░░░░ 10%  (设计完成)

总体进度:            ████████████████░░░░░░░░ 65%
```

### 代码规模

```
源代码文件:          约400个 .cs 文件
核心代码行数:        约30,000+ 行
游戏资源:            2,800+ 个文件
本地化条目:          数千条
```

---

## 当前问题与限制

### 🔴 关键问题

#### 1. 存档系统未完成
**严重程度**: ⚠️⚠️⚠️⚠️⚠️ 非常严重  
**描述**: mod.json中明确标注"存档无效"，这是阻碍玩家正常游玩的主要问题。

**原因分析**:
- ECS实体数据未正确序列化
- 自定义组件（Xian, Jindan, Yuanying等）可能未实现`ICanCopy`接口
- 关系数据（Relations）未妥善保存
- 扩展管理器（ActorExtend等）的状态未持久化

**影响范围**:
- 玩家无法保存游戏进度
- 无法进行长期游戏测试
- 阻碍内容平衡调整

**解决方案**:
1. 检查所有自定义组件，确保实现`ICanCopy`和`ICanReload`接口
2. 实现ECS实体的序列化/反序列化逻辑
3. 测试存档加载后的数据完整性
4. 添加存档版本控制机制

#### 2. 性能优化缺失
**严重程度**: ⚠️⚠️⚠️ 严重  
**描述**: 标记为"无优化"，可能在大规模场景下导致卡顿。

**潜在瓶颈**:
- `GeneralLogicSystems`中多个System每帧更新
- 灵气扩散系统（WakanSpreadSystem）可能计算量大
- 碰撞检测（LogicActorCollisionSystem）未做空间优化
- 大量Entity查询可能未使用索引

**性能监控**:
- 已实现性能日志系统（`LogPerf()`）
- 系统级性能监控（`SetMonitorPerf(true)`）
- 每10分钟自动记录性能数据

**优化方向**:
1. 使用ECS的并行查询（已有`ParallelJobRunner`）
2. 灵气扩散改为异步计算或降低更新频率
3. 碰撞检测加入空间分区（Spatial Hash）
4. 缓存常用查询结果

#### 3. 词条系统未完全体
**严重程度**: ⚠️⚠️ 中等  
**描述**: 28个设计的法术词条中已完成11个，仍有部分高优先级特效/机制待打磨。

**已完成**: 减速、强化、剧毒、灼烧、巨大、击飞、冰冻、爆炸、衰弱、破甲、引力（特效待补）  
**高优先级待完善**: 引力特效、其他仍在设计中的稀有词条

**阻塞问题**:
- 部分词条需要复杂的弹道修改（如引力、颠倒）
- 珍稀词条涉及存档持久化（如永世诅咒）
- 随机词条需要二次抽取逻辑

---

### 🟡 次要问题

#### 4. 宗门系统功能不完整
**严重程度**: ⚠️⚠️ 中等  
**当前状态**: 仅有基础框架，缺少实际玩法

**缺失功能**:
- 宗门成员招募机制
- 宗门任务系统
- 宗门之间的外交关系
- 宗门资源管理
- 宗门领地系统
- 宗门贡献度

#### 5. 功法系统未实现
**严重程度**: ⚠️⚠️ 中等  
**描述**: Roadmap中标注为未完成，但已有部分框架（Cultibook）  
**详细设计**: 参见 [CultibookSystem.md](CultibookSystem.md)

**已有基础**:
- 功法书组件（Cultibook）
- 师承关系（CultibookMasterRelation）
- 编写功法行为（BehWriteCultibook）

**缺失核心**:
- 主修/了解功法区分
- 多种修炼方式（水中修炼、杀戮修炼、国运修炼等）
- 法术池与领悟系统
- 功法冲突与兼容性
- 转修机制

#### 6. 五行法术未实现
**严重程度**: ⚠️ 较轻  
**描述**: 当前仅有御器系列法术，缺少五行元素法术

**设计方向**:
- 金系：攻击、锐利、穿透
- 木系：生长、恢复、束缚
- 水系：流动、侵蚀、防御
- 火系：爆发、灼烧、范围
- 土系：护盾、迟缓、控制

#### 7. 炼器系统未启动
**严重程度**: ⚠️ 较轻  
**描述**: Roadmap中标注为未完成

**可能实现**:
- 参考丹药系统的架构
- 法宝品质与属性
- 炼器配方与材料
- 法宝强化与进阶

#### 8. 元婴夺舍未实现
**严重程度**: ⚠️ 较轻  
**描述**: 进阶玩法功能

**技术难点**:
- 灵魂与肉体分离
- 目标兼容性判定
- 记忆与技能继承
- 夺舍后的身份管理

---

### 🟢 已知小问题

#### 9. 测试与平衡
- 词条数值未经充分测试
- 丹药效果强度可能不平衡
- 修炼速度需要调整
- AI行为可能出现逻辑死锁

#### 10. UI与本地化
- 部分UI界面粗糙
- 本地化文本可能有遗漏
- 图标资源质量不一致

#### 11. 文档
- 代码注释多为中文
- 缺少API文档
- 部分设计文档过时

---

## 后续开发计划

> **开发策略**: 内容优先，先打磨丰富核心玩法（法术、修炼、功法、炼丹、制符、材料收集），存档和性能优化放到最后整体完成时再做。

### 第一阶段：核心内容打磨 (2-3个月)

#### 优先级1：法术系统完善 ⏰估计3-4周

##### 1.1 法术词条系统补完 ⏰估计2周
**目标**: 完成战斗体验提升最明显的词条

**高优先级词条**:
1. **爆炸（Explosion）** - ✅已完成
   - [x] OnEffectObj触发
   - [x] 范围伤害计算
   - [x] 爆炸动画生成（参考Fireball实现）
   - [x] 敌人判定
   
2. **冰冻（Freeze）** - ✅已完成
   - [x] OnEffectObj触发
   - [x] 冰冻状态效果（`StatusEffects.cs`）
   - [x] 禁止移动和攻击（通过BaseStats tag实现）
   - [x] 冰霜视觉特效
   
3. **击飞（Knockback）** - ✅已完成
   - [x] OnEffectObj触发
   - [x] 击飞力计算（考虑目标质量、重力）
   - [x] 抛物线轨迹（距离和高度可配置）
   - [ ] 冲击波特效（待补充）
   
5. **引力（Gravity）** - ✅基础逻辑已完成（特效待补）
   - [x] OnTravel阶段吸附逻辑
   - [x] 范围吸附力与持续判定
   - [ ] 引力扭曲/黑洞特效（进行中）

**中优先级词条** ⏰估计1周:
- 急速、熟练、懵逼

##### 1.2 五行法术体系 ⏰估计2周
**目标**: 实现五行元素法术，丰富技能多样性

**金系法术**（攻击、锐利、穿透）:
- [x] 金剑术（单体高伤）
- [ ] 金刚护体（护盾）
- [ ] 金针刺（穿透）
- [x] 金刃风暴（AOE）
- [ ] 金身术（免伤）

**木系法术**（生长、恢复、束缚）:
- [ ] 藤蔓缠绕（控制）
- [ ] 生命之泉（恢复）
- [x] 木刺突袭（快速攻击）
- [ ] 荆棘领域（反伤）
- [x] 落木术（伤害）

**水系法术**（流动、侵蚀、防御）:
- [x] 水箭术（基础攻击）
- [ ] 水盾术（防御）
- [x] 水球术（伤害）
- [ ] 洪流冲击（击退）
- [ ] 水愈术（持续恢复）

**火系法术**（爆发、灼烧、范围）:
- [x] 火球术（爆炸）
- [x] 火刃风暴（AOE）
- [ ] 炎爆术（高伤）
- [ ] 焚天烈焰（大范围）
- [ ] 凤凰涅槃（复活）

**土系法术**（护盾、迟缓、控制）:
- [ ] 土墙术（障碍）
- [ ] 流沙术（陷阱）
- [x] 岩刺术（控制+伤害）
- [ ] 大地之怒（震荡）
- [x] 落石术（控制）

**实现要点**:
- 基于现有`SkillEntityAsset`框架
- 使用元素属性判定
- 元素相克系统（金克木、木克土等）
- AI根据灵根倾向选择法术

---

#### 优先级2：修炼与功法系统 ⏰估计3周

##### 2.1 功法系统实现 ⏰估计6.5周
**目标**: 实现完整的功法学习与修炼系统  
**详细设计**: 参见 [CultibookSystem.md](CultibookSystem.md)

**核心机制**:
- [ ] 主修/了解功法区分（只有一个主修功法）
- [ ] 掌握程度系统（0-100%）
- [ ] 转修机制（有风险的功法切换）
- [ ] 功法传承（师徒/宗门）

**修炼方式**:
- [ ] 标准闭关修炼
- [ ] 水中修炼（水系功法）
- [ ] 山巅修炼（吸收天地灵气）
- [ ] 林中修炼（木系功法）
- [ ] 战斗修炼（以战养战）
- [ ] 杀戮吸收（魔道）
- [ ] 国运修炼（帝王道）
- [ ] 功德修炼（佛道）

**法术池系统**:
- [ ] 功法附带可领悟法术
- [ ] 钻研过程中可能领悟法术
- [ ] 领悟概率受掌握程度/智力/灵根影响

**AI行为**:
- [ ] 选择适合的功法
- [ ] 根据修炼方式执行对应行为
- [ ] 转修决策
- [ ] 传授功法

##### 2.2 修炼体验优化 ⏰估计1周
**目标**: 让修炼过程更有层次感

**修炼细节**:
- [ ] 修炼瓶颈与突破
- [ ] 顿悟/走火入魔机制
- [ ] 闭关修炼
- [ ] 灵气品质影响

**境界表现**:
- [ ] 不同境界的视觉表现
- [ ] 境界威压效果
- [ ] 天劫系统（高境界）

---

#### 优先级3：炼丹系统深化 ⏰估计2周

##### 3.1 丹药体系丰富
**目标**: 增加丹药种类，丰富炼丹玩法

**丹药分类扩充**:
- [ ] 恢复类丹药（已有基础）
- [ ] 突破类丹药（辅助晋升）
- [ ] 增益类丹药（临时属性提升）
- [ ] 解毒/疗伤丹药
- [ ] 特殊类丹药（改善资质等）

**丹方创新**:
- [ ] 丹方创造的深度逻辑
- [ ] 配方失败机制
- [ ] 丹药品质系统（下品/中品/上品/极品）
- [ ] 炼丹成功率影响因素

##### 3.2 炼丹体验
**目标**: 让炼丹过程更有仪式感

**炼丹过程**:
- [ ] 炼丹火候控制
- [ ] 炼丹时间与专注度
- [ ] 炼丹副产物（丹渣、废丹）
- [ ] 丹炉系统（影响成功率）

**AI炼丹优化**:
- [ ] 智能配方选择
- [ ] 材料优先级
- [ ] 炼丹任务分配

---

#### 优先级4：制符系统完善 ⏰估计2周

##### 4.1 符箓体系构建
**目标**: 让符箓成为有价值的消耗品

**符箓分类**:
- [ ] 攻击符（火符、雷符、冰符）
- [ ] 防御符（护身符、金钟符）
- [ ] 辅助符（隐身符、加速符）
- [ ] 控制符（定身符、封印符）
- [ ] 特殊符（传送符、通讯符）

**符箓制作**:
- [ ] 符箓配方系统
- [ ] 符箓品质（灵符/宝符/仙符）
- [ ] 制符材料（符纸、灵墨、灵血）
- [ ] 制符成功率

##### 4.2 符箓使用
**目标**: 完善符箓的战斗应用

**使用机制**:
- [ ] 主动使用符箓
- [ ] 被动触发符箓（护身符）
- [ ] 符箓叠加与冲突
- [ ] AI自动使用符箓

---

#### 优先级5：材料收集系统 ⏰估计2周

##### 5.1 材料体系整理
**目标**: 构建完整的材料获取循环

**材料分类**:
- [ ] 灵草材料（已有基础）
- [ ] 矿石材料
- [ ] 妖兽材料（妖丹、妖骨、妖皮）
- [ ] 天材地宝（稀有材料）
- [ ] 炼制产物（丹渣、废符可作材料）

**材料属性**:
- [ ] 材料品质等级
- [ ] 材料五行属性
- [ ] 材料年份/灵气浓度
- [ ] 材料保存与腐败

##### 5.2 材料获取途径
**目标**: 让材料获取更有趣

**获取方式**:
- [ ] 采集系统优化（灵草、矿石）
- [ ] 狩猎系统（妖兽掉落）
- [ ] 交易系统（宗门/城镇商店）
- [ ] 探索发现（秘境、遗迹）
- [ ] 种植系统（灵田种植灵草）

**AI行为优化**:
- [ ] 智能采集路线
- [ ] 材料需求判断
- [ ] 材料分享与交易

---

### 第二阶段：系统联动与扩展 (1-2个月)

#### 炼器系统 ⏰估计2-3周
**目标**: 补完修仙四艺（丹符阵器）

**任务清单**:
1. **法宝框架**
   - [ ] 法宝组件（`Weapon` Component）
   - [ ] 法宝品质（下品、中品、上品、极品、灵宝）
   - [ ] 法宝属性系统
   - [ ] 法宝技能
   
2. **炼器配方**
   - [ ] 配方定义（`WeaponAsset`）
   - [ ] 材料需求
   - [ ] 炼器难度
   
3. **炼器过程**
   - [ ] 炼器行为（`BehCraftWeapon`）
   - [ ] 成功率计算
   - [ ] 品质随机
   - [ ] 特殊属性抽取
   
4. **法宝强化**
   - [ ] 法宝升级
   - [ ] 法宝进阶
   - [ ] 法宝重铸
   
5. **AI行为**
   - [ ] 自主炼器
   - [ ] 法宝选择
   - [ ] 法宝使用
   
6. **数据内容**
   - [ ] 设计20-30个法宝
   - [ ] 炼器配方
   - [ ] 本地化

---

### 第三阶段：内容扩充 (1-2个月)

#### 词条系统完成 ⏰估计2-3周
**目标**: 完成所有28个设计词条

**罕见词条**:
- [ ] 怜悯（Mercy）
- [ ] 混乱（Chaos）
- [ ] 颠倒（Swap）
- [ ] 随机（Random Affix）
- [ ] 燃尽（Burnout）
- [ ] 合击（Combo）

**珍稀词条**:
- [ ] 封印（Silence）
- [ ] 终焉死亡（Death Sentence）
- [ ] 轮回试练（Reincarnation Trial）
- [ ] 永世诅咒（Eternal Curse）

**特殊处理**:
- 永世诅咒需要存档持久化
- 随机词条需要二次抽取逻辑
- 合击需要技能组合系统

---

#### 元婴进阶功能 ⏰估计1-2周
**目标**: 实现元婴特有的高级功能

**任务清单**:
1. **元婴出窍**
   - [ ] 灵魂与肉体分离
   - [ ] 元婴独立行动
   - [ ] 元婴战斗
   
2. **元婴夺舍**
   - [ ] 夺舍目标判定
   - [ ] 灵魂强度对比
   - [ ] 夺舍成功率
   - [ ] 记忆继承
   - [ ] 技能继承
   - [ ] 身份转换
   
3. **元婴分神**
   - [ ] 分身创建
   - [ ] 分身同步
   
4. **元婴劫难**
   - [ ] 天劫系统
   - [ ] 心魔劫
   - [ ] 劫后奖励

---

#### 地形与环境扩展 ⏰估计2周
**目标**: 丰富游戏环境

**任务清单**:
1. **地形分类与命名**
   - [ ] 灵山（高灵气）
   - [ ] 仙岛（特殊资源）
   - [ ] 魔域（高浊气）
   - [ ] 绝地（危险区域）
   
2. **特殊地形效果**
   - [ ] 灵脉（灵气汇聚点）
   - [ ] 灵泉（恢复效果）
   - [ ] 魔气污染
   
3. **动态环境**
   - [ ] 灵气潮汐
   - [ ] 地脉震荡
   - [ ] 天象异变

---

#### 事件与剧情 ⏰估计1-2周
**目标**: 增加游戏随机性和趣味性

**随机事件** (已有框架`RandomEventLibrary`):
- [ ] 天降灵宝
- [ ] 秘境开启
- [ ] 异兽出现
- [ ] 宗门大会
- [ ] 天劫降临
- [ ] 魔族入侵
- [ ] 仙人传承

**剧情系统**:
- [ ] 世界大事件
- [ ] 宗门剧情
- [ ] 个人剧情

---

### 第四阶段：优化与完善 (持续)

#### 平衡性调整
- [ ] 数值平衡测试
- [ ] 难度曲线调整
- [ ] 资源产出平衡

#### UI/UX改进
- [ ] 界面美化
- [ ] 交互优化
- [ ] 信息展示改进

#### 内容补充
- [ ] 更多功法
- [ ] 更多丹药
- [ ] 更多法术
- [ ] 更多法宝

#### 文档完善
- [ ] API文档
- [ ] 设计文档
- [ ] 玩家指南
- [ ] Mod开发指南

---

## 优先级任务清单

> **开发策略**: 内容优先，存档和性能最后整体优化

### 🔴 紧急且重要（立即执行）

1. **法术词条补完** ⏰2周
   - 引力视觉特效（逻辑已上线）
   - 明显提升战斗体验
   - ✅ 击飞、冰冻、爆炸已完成
   
2. **五行法术体系** ⏰2周
   - 丰富技能多样性
   - 与灵根系统联动

### 🟠 重要不紧急（近期计划）

3. **功法系统** ⏰2-3周
   - Roadmap中的主要功能
   - 影响后续平衡

4. **炼丹系统深化** ⏰2周
   - 丰富丹药种类与品质
   - 优化AI炼丹行为

5. **制符系统完善** ⏰2周
   - 符箓分类与效果
   - 符箓制作与使用

6. **材料收集系统** ⏰2周
   - 材料体系整理
   - 获取途径丰富化

### 🟡 中期计划（系统联动）

7. **炼器系统** ⏰2-3周
   - 法宝制作与强化
   
8. **宗门系统扩展** ⏰2-3周
   - 成员管理与宗门资源
   
9. **高级词条补完** ⏰2周
   - 罕见与珍稀词条

### 🟢 后期计划（内容完成后）

10. **存档系统** ⏰2-3周
    - 待内容基本完成后统一实现
    
11. **性能优化** ⏰2周
    - 待内容基本完成后统一优化
    
12. **元婴夺舍** ⏰1-2周
13. **地形扩展** ⏰2周
11. **事件系统** ⏰1-2周

---

## 开发建议

### 对于核心开发者

1. **先修复存档和性能**
   - 这两个问题不解决，后续开发和测试都会受阻
   - 建议分配最有经验的开发者负责
   
2. **优先完成词条**
   - 词条系统设计已经很完善（`Doc/ModifierEffects.md`）
   - 实现相对独立，可以并行开发
   - 能快速提升游戏可玩性
   
3. **功法系统需要设计**
   - 当前缺少详细设计文档
   - 建议先完成设计文档再开发
   - 可以参考丹药系统的成功经验
   
4. **保持代码质量**
   - 继续保持清晰的模块化结构
   - 及时补充注释和文档
   - 定期code review

### 对于内容创作者

1. **准备功法内容**
   - 设计功法名称、描述
   - 设计功法效果
   - 准备本地化文本
   
2. **准备法术内容**
   - 五行法术的具体效果
   - 法术名称和描述
   - 视觉效果需求
   
3. **准备法宝内容**
   - 法宝名称、类型
   - 法宝属性设计
   - 炼器配方

### 对于美术资源

1. **词条特效**
   - 各种词条需要视觉特效
   - 爆炸、冰冻、引力等特效最重要
   
2. **法术特效**
   - 五行法术的特效素材
   - 保持统一的美术风格
   
3. **UI界面**
   - 宗门界面设计
   - 法宝界面设计
   - 功法界面设计

### 对于测试

1. **建立测试场景**
   - 快速生成各境界修仙者
   - 快速生成各类物品
   - 自动化测试脚本
   
2. **数值平衡测试**
   - 修炼速度测试
   - 战斗平衡测试
   - 资源产出测试
   
3. **压力测试**
   - 大量修仙者场景
   - 长时间运行测试
   - 内存泄漏检测

---

## 里程碑规划

> **策略**: 内容优先开发，存档与优化放到最后阶段

### Milestone 1: 核心玩法完整版 (2-3个月内)
- ✅ 法术词条系统完成（15个以上）
- ✅ 五行法术体系完整
- ✅ 功法系统实现
- ✅ 炼丹系统深化（品质、多样性）
- ✅ 制符系统完善
- ✅ 材料收集体系完整
- 📦 发布 v0.1.0 内容预览版

### Milestone 2: 系统联动版 (4-5个月内)
- ✅ 炼器系统完整
- ✅ 宗门系统扩展
- ✅ 所有词条完成
- ✅ 元婴进阶功能
- ✅ 内容充实（功法、法术、丹药各20+）
- 📦 发布 v0.2.0 功能完整版

### Milestone 3: 正式版 (6-7个月内)
- ✅ 存档系统正常工作
- ✅ 性能优化达标
- ✅ 地形与环境扩展
- ✅ 数值平衡
- ✅ UI完善
- ✅ 主要bug修复
- 📦 发布 v1.0.0

---

## 技术债务

### 需要重构的部分

1. **技能系统架构**
   - 当前已经是V3版本，说明经历过重构
   - 长期目标：简化优化技能框架（Roadmap中已标注）
   
2. **存档格式**
   - 当前可能缺少版本管理
   - 需要设计向后兼容机制
   
3. **配置系统**
   - 部分配置硬编码
   - 需要统一配置管理

### 需要补充的测试

1. **单元测试**
   - 当前缺少自动化测试
   - 关键逻辑需要测试覆盖
   
2. **集成测试**
   - 系统间交互测试
   - 存档兼容性测试
   
3. **性能测试**
   - 基准测试建立
   - 回归测试

---

## 社区与支持

### 贡献方式

1. **代码贡献**
   - Fork & Pull Request
   - 遵循现有代码风格
   - 补充注释和文档
   
2. **内容贡献**
   - 设计新功法
   - 设计新丹药
   - 设计新法术
   - 提供本地化翻译
   
3. **美术贡献**
   - 技能特效
   - UI界面
   - 图标资源
   
4. **测试与反馈**
   - Bug报告
   - 平衡性建议
   - 功能建议

### 联系方式

- **爱发电**: https://afdian.com/a/inmny
- **GitHub**: https://github.com/inmny/Cultiway-Reborn

---

## 总结

修仙[Reborn]项目已经完成了坚实的技术基础和核心功能框架。

### 当前开发策略：**内容优先**

按照开发者的规划，当前阶段专注于打磨丰富核心玩法内容：

1. **法术系统** - 词条补完 + 五行法术体系
2. **修炼与功法** - 功法系统实现 + 修炼体验优化
3. **炼丹系统** - 丹药种类丰富 + 品质系统
4. **制符系统** - 符箓分类与制作
5. **材料收集** - 完整的材料获取循环

存档和性能优化将在内容基本完成后再统一处理，这是合理的开发策略——先有内容，再谈稳定。

### 项目进度

项目整体进度约**65%**，预计在**6-7个月内**可以达到正式版发布标准。

**核心优势**：
- ✅ 优秀的技术架构（ECS + 模块化）
- ✅ 清晰的代码组织
- ✅ 完整的修仙体系框架
- ✅ 丰富的AI行为系统
- ✅ 强大的内容生成工具（AIGC）
- ✅ 已有的丹药、境界、技能基础

**当前重点**：
- 🔥 法术词条补完（✅击飞、冰冻、爆炸、引力基础逻辑已完成，特效待补）
- 🔥 五行法术体系
- 🔥 功法系统实现
- 🔥 炼丹/制符深化
- 🔥 材料收集系统

**后续计划**：
- 📋 炼器系统
- 📋 宗门扩展
- 📋 高级词条
- 📋 元婴夺舍
- 📋 存档与性能（最后阶段）

相信在持续的内容打磨下，这将成为一个优秀的修仙题材模组！

---

**文档维护**: 请在每次重大更新后更新此文档  
**下次审查**: 完成Milestone 1后

