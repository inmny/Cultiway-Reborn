# åŠŸæ³•ç³»ç»Ÿ (Cultibook System) è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.1  
**çŠ¶æ€**: å¼€å‘ä¸­  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæœºåˆ¶](#æ ¸å¿ƒæœºåˆ¶)
3. [æ•°æ®ç»“æ„è®¾è®¡](#æ•°æ®ç»“æ„è®¾è®¡)
4. [åŠŸæ³•åˆ†ç±»ä½“ç³»](#åŠŸæ³•åˆ†ç±»ä½“ç³»)
5. [ä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ](#ä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ)
6. [æ³•æœ¯æ± ç³»ç»Ÿ](#æ³•æœ¯æ± ç³»ç»Ÿ)
7. [AIè¡Œä¸ºè®¾è®¡](#aiè¡Œä¸ºè®¾è®¡)
8. [UIç•Œé¢è®¾è®¡](#uiç•Œé¢è®¾è®¡)
9. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
10. [å¼€å‘TODO](#å¼€å‘todo)

---

## ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç›®æ ‡

åŠŸæ³•ç³»ç»Ÿæ˜¯ä¿®ä»™ä½“ç³»çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œä¸ºä¿®å£«æä¾›ç‹¬ç‰¹çš„ä¿®ç‚¼è·¯å¾„ã€å±æ€§åŠ æˆå’ŒæŠ€èƒ½å­¦ä¹ æ¸ é“ã€‚æœ¬ç³»ç»Ÿæ—¨åœ¨ï¼š

1. **ä¸°å¯Œä¿®ç‚¼ç©æ³•** - ä¸åŒåŠŸæ³•æä¾›ä¸åŒçš„ä¿®ç‚¼æ–¹å¼ï¼Œè®©ç©å®¶ä½“éªŒå¤šæ ·åŒ–çš„ä¿®ä»™è·¯å¾„
2. **å¢åŠ è§’è‰²å·®å¼‚åŒ–** - åŠŸæ³•é€‰æ‹©å½±å“è§’è‰²å‘å±•æ–¹å‘
3. **æä¾›ç¤¾äº¤äº’åŠ¨** - åŠŸæ³•ä¼ æ‰¿ã€è½¬ä¿®ç­‰æœºåˆ¶ä¿ƒè¿›NPCé—´äº’åŠ¨
4. **å¹³è¡¡æ¸¸æˆä½“éªŒ** - é€šè¿‡æŒæ¡ç¨‹åº¦é™åˆ¶ï¼Œé¿å…å­¦ä¹ è¿‡å¤šåŠŸæ³•å¯¼è‡´å¤±è¡¡

### æ ¸å¿ƒç†å¿µ

- **ä¸€ä¸»å¤šè¾…**: ä¿®å£«å¯ä»¥å­¦ä¹ å¤šéƒ¨åŠŸæ³•ï¼Œä½†åªæœ‰ä¸€éƒ¨ä½œä¸º"ä¸»ä¿®"ï¼Œå…¶ä½™ä¸º"äº†è§£"
- **ä¸“ç²¾æœ‰ç›Š**: ä¸»ä¿®åŠŸæ³•äº«å—å®Œæ•´æ•ˆæœï¼Œäº†è§£çš„åŠŸæ³•ä»…ä½œä¼ æ‰¿ç”¨é€”
- **ä¿®ç‚¼æ–¹å¼å¤šå…ƒåŒ–**: ä¸åŒåŠŸæ³•æä¾›ç‹¬ç‰¹çš„ä¿®ç‚¼é€”å¾„
- **æ³•æœ¯é¢†æ‚Ÿ**: ä¿®ç‚¼åŠŸæ³•è¿‡ç¨‹ä¸­å¯èƒ½é¢†æ‚Ÿå…¶ä¸­è•´å«çš„æ³•æœ¯

---

## æ ¸å¿ƒæœºåˆ¶

### 2.1 å­¦ä¹ ä¸æŒæ¡

#### ä¸»ä¿®åŠŸæ³•
- æ¯ä¸ªä¿®å£«**åªèƒ½æœ‰ä¸€éƒ¨ä¸»ä¿®åŠŸæ³•**
- ä¸»ä¿®åŠŸæ³•äº«å—**å®Œæ•´çš„å±æ€§åŠ æˆ**
- ä¸»ä¿®åŠŸæ³•æä¾›çš„**ä¿®ç‚¼æ–¹å¼ç”Ÿæ•ˆ**
- é’»ç ”ä¸»ä¿®åŠŸæ³•æ—¶**å¯èƒ½é¢†æ‚Ÿæ³•æœ¯**
- æŒæ¡ç¨‹åº¦å½±å“æ•ˆæœå¼ºåº¦ï¼ˆ0-100%ï¼‰

#### äº†è§£åŠŸæ³•
- ä¿®å£«å¯ä»¥**äº†è§£å¤šéƒ¨åŠŸæ³•**
- äº†è§£çš„åŠŸæ³•**ä¸æä¾›å±æ€§åŠ æˆ**
- äº†è§£çš„åŠŸæ³•**æ— æ³•ä½¿ç”¨å…¶ä¿®ç‚¼æ–¹å¼**
- äº†è§£çš„åŠŸæ³•**å¯ä»¥æŠ„å½•æˆä¹¦**ä¼ æˆä»–äºº
- äº†è§£ç¨‹åº¦è®°å½•ï¼šä»…ä½œä¸ºæŠ„å½•è´¨é‡çš„å‚è€ƒ

#### è½¬ä¿®æœºåˆ¶
- ä¿®å£«å¯ä»¥é€‰æ‹©**è½¬ä¿®**ï¼Œå°†æŸéƒ¨äº†è§£çš„åŠŸæ³•è®¾ä¸ºä¸»ä¿®
- è½¬ä¿®æ—¶ï¼ŒåŸä¸»ä¿®åŠŸæ³•å˜ä¸º"äº†è§£"
- è½¬ä¿®æœ‰**æ•£åŠŸé£é™©**ï¼š
  - åŸºç¡€æˆåŠŸç‡ï¼š70%
  - å—æ™ºåŠ›(intelligence)å½±å“
  - å—æ–°åŠŸæ³•ä¸çµæ ¹çš„å¥‘åˆåº¦å½±å“
  - å¤±è´¥æ—¶æŸå¤±ä¸€å®šçµåŠ›(wakan)ï¼Œä¸¥é‡æ—¶å¯èƒ½æ‰è½å¢ƒç•Œ
- è½¬ä¿®åéœ€è¦é‡æ–°ç§¯ç´¯æŒæ¡ç¨‹åº¦

### 2.2 æŒæ¡ç¨‹åº¦

æŒæ¡ç¨‹åº¦å†³å®šåŠŸæ³•æ•ˆæœçš„å‘æŒ¥æ¯”ä¾‹ï¼š

| æŒæ¡ç¨‹åº¦ | æ•ˆæœæ¯”ä¾‹ | æè¿° |
|---------|---------|------|
| 0-20% | åŸºç¡€å…¥é—¨ | åˆæ­¥æ„Ÿæ‚Ÿï¼Œæ•ˆæœå¾®å¼± |
| 20-40% | å°æˆ | åŸºæœ¬æŒæ¡æ ¸å¿ƒï¼Œæ•ˆæœä¸€èˆ¬ |
| 40-60% | å¤§æˆ | ç†Ÿç»ƒè¿ç”¨ï¼Œæ•ˆæœæ˜æ˜¾ |
| 60-80% | åœ†æ»¡ | èä¼šè´¯é€šï¼Œæ•ˆæœæ˜¾è‘— |
| 80-100% | ç™»å³°é€ æ | å®Œç¾æŒæ¡ï¼Œæ•ˆæœæœ€å¤§åŒ– |

**æŒæ¡ç¨‹åº¦å¢é•¿å› ç´ **ï¼š
- ä¿®ç‚¼æ—¶é—´
- æ™ºåŠ›(intelligence)
- çµæ ¹ä¸åŠŸæ³•å±æ€§çš„å¥‘åˆåº¦
- æ˜¯å¦æœ‰å¸ˆæ‰¿å…³ç³»ï¼ˆæœ‰å¸ˆå‚…æ•™å¯¼ä¼šåŠ é€Ÿï¼‰

### 2.3 åŠŸæ³•ä¼ æ‰¿

- **åˆ›ä½œåŠŸæ³•**: å…ƒå©´å¢ƒç•Œä»¥ä¸Šçš„ä¿®å£«å¯ä»¥åˆ›ä½œæ–°åŠŸæ³•
- **è‘—ä¹¦ä¼ æ‰¿**: äº†è§£æˆ–ä¸»ä¿®çš„åŠŸæ³•éƒ½å¯ä»¥æŠ„å½•æˆä¹¦
- **å¸ˆå¾’ä¼ æ‰¿**: æ‹¥æœ‰å¸ˆæ‰¿å…³ç³»æ—¶ï¼Œå­¦ä¹ æ•ˆç‡æå‡
- **å®—é—¨åŠŸæ³•**: å®—é—¨å¯ä»¥è®¾å®šå®—é—¨åŠŸæ³•ï¼Œæ–°å…¥é—¨å¼Ÿå­ä¼˜å…ˆå­¦ä¹ 

---

## æ•°æ®ç»“æ„è®¾è®¡

### 3.1 CultibookAsset (åŠŸæ³•èµ„æºå®šä¹‰)

```csharp
public class CultibookAsset : Asset, IDeleteWhenUnknown
{
    // åŸºç¡€ä¿¡æ¯
    public string Name;                      // åŠŸæ³•åç§°
    public string Description;               // æè¿°æ–‡æœ¬
    public ItemLevel Level;                  // åŠŸæ³•å“é˜¶ï¼ˆäººçº§/åœ°çº§/å¤©çº§/ä»™çº§ï¼‰
    
    // å±æ€§æ•ˆæœï¼ˆä¸»ä¿®æ—¶ç”Ÿæ•ˆï¼‰
    public BaseStats FinalStats;             // æ»¡æŒæ¡æ—¶çš„å±æ€§åŠ æˆ
    
    // å…ƒç´ å±æ€§è¦æ±‚ä¸äº²å’Œ
    public ElementRequirement ElementReq;    // çµæ ¹éœ€æ±‚
    public float ElementAffinity;            // çµæ ¹å¥‘åˆåº¦é˜ˆå€¼
    
    // å¢ƒç•Œé™åˆ¶
    public int MinLevel;                     // æœ€ä½å¢ƒç•Œè¦æ±‚
    public int MaxLevel;                     // æœ€é«˜å¯ç”¨å¢ƒç•Œï¼ˆè¶…è¿‡åæ•ˆæœè¡°å‡ï¼‰
    
    // ä¿®ç‚¼æ–¹å¼
    public string CultivateMethodId;         // ä¿®ç‚¼æ–¹å¼Asset ID
    
    // æ³•æœ¯æ± 
    public List<SkillPoolEntry> SkillPool;   // å¯é¢†æ‚Ÿçš„æ³•æœ¯åˆ—è¡¨
    
    // å†²çªä¸å…¼å®¹
    public string[] ConflictTags;            // å†²çªæ ‡ç­¾ï¼ˆå¦‚æ­£é‚ªä¸ä¸¤ç«‹ï¼‰
    public string[] SynergyTags;             // ååŒæ ‡ç­¾ï¼ˆå¦‚åŒæºåŠŸæ³•ï¼‰
    
    // ç»Ÿè®¡
    public int Current { get; set; } = 0;    // å½“å‰å­¦ä¹ æ­¤åŠŸæ³•çš„äººæ•°
}
```

### 3.2 ElementRequirement (çµæ ¹éœ€æ±‚)

```csharp
public struct ElementRequirement
{
    public float MinIron;    // æœ€ä½é‡‘å…ƒç´ 
    public float MinWood;    // æœ€ä½æœ¨å…ƒç´ 
    public float MinWater;   // æœ€ä½æ°´å…ƒç´ 
    public float MinFire;    // æœ€ä½ç«å…ƒç´ 
    public float MinEarth;   // æœ€ä½åœŸå…ƒç´ 
    public float MinNeg;     // æœ€ä½é˜´å…ƒç´ 
    public float MinPos;     // æœ€ä½é˜³å…ƒç´ 
    public float MinEntropy; // æœ€ä½æ··æ²Œå…ƒç´ 
    
    // æ£€æŸ¥çµæ ¹æ˜¯å¦æ»¡è¶³éœ€æ±‚
    public bool Check(ElementRoot root);
    // è®¡ç®—å¥‘åˆåº¦ï¼ˆ0-1ï¼‰
    public float GetAffinity(ElementRoot root);
}
```

### 3.3 CultivateMethodAsset (ä¿®ç‚¼æ–¹å¼èµ„æº)

ä¿®ç‚¼æ–¹å¼é‡‡ç”¨ Asset è€Œé Enumï¼Œé€šè¿‡å§”æ‰˜å®šä¹‰çµæ´»çš„ä¿®ç‚¼è¡Œä¸ºï¼š

```csharp
public class CultivateMethodAsset : Asset
{
    // ========== æ ¸å¿ƒå§”æ‰˜ ==========
    
    /// <summary>
    /// æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨æ­¤ä¿®ç‚¼æ–¹å¼
    /// </summary>
    /// <param name="ae">ä¿®ç‚¼è€…æ‰©å±•</param>
    /// <returns>æ˜¯å¦æ»¡è¶³ä¿®ç‚¼æ¡ä»¶</returns>
    public Func<ActorExtend, bool> CanCultivate;
    
    /// <summary>
    /// è®¡ç®—ä¿®ç‚¼æ•ˆç‡ç³»æ•°
    /// </summary>
    /// <param name="ae">ä¿®ç‚¼è€…æ‰©å±•</param>
    /// <returns>æ•ˆç‡ç³»æ•°ï¼ˆ1.0ä¸ºæ ‡å‡†ï¼‰</returns>
    public Func<ActorExtend, float> GetEfficiency;
    
    /// <summary>
    /// ä¿®ç‚¼å‰¯ä½œç”¨ï¼ˆå¦‚é­”é“çš„æ€ä¸šç§¯ç´¯ï¼‰
    /// </summary>
    /// <param name="ae">ä¿®ç‚¼è€…æ‰©å±•</param>
    /// <param name="wakanGained">æœ¬æ¬¡è·å¾—çš„çµåŠ›</param>
    public Action<ActorExtend, float> OnSideEffect;
    
    // ========== AIè¡Œä¸ºç›¸å…³ ==========
    
    /// <summary>
    /// è·å–å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡IDï¼ˆç”¨äºæ›¿æ¢æ ‡å‡†ä¿®ç‚¼è¡Œä¸ºï¼‰
    /// </summary>
    /// <param name="ae">ä¿®ç‚¼è€…æ‰©å±•</param>
    /// <returns>è¡Œä¸ºä»»åŠ¡ID</returns>
    public Func<ActorExtend, string> GetBehaviourJobId;
    
    // ========== è§¦å‘æ¡ä»¶ ==========
    
    /// <summary>
    /// ä¿®ç‚¼è§¦å‘ç±»å‹
    /// </summary>
    public CultivateTriggerType TriggerType = CultivateTriggerType.Active;
    
    /// <summary>
    /// è¢«åŠ¨è§¦å‘æ—¶çš„äº‹ä»¶ç±»å‹é›†åˆï¼ˆå¦‚æˆ˜æ–—ä¿®ç‚¼åœ¨æ”»å‡»æ—¶è§¦å‘ï¼‰
    /// </summary>
    public HashSet<PassiveTriggerEvents> PassiveTriggerEvents = new();
}

/// <summary>
/// ä¿®ç‚¼è§¦å‘ç±»å‹
/// </summary>
public enum CultivateTriggerType
{
    Active,     // ä¸»åŠ¨ä¿®ç‚¼ï¼ˆéœ€è¦ä¸“é—¨çš„ä¿®ç‚¼è¡Œä¸ºï¼‰
    Passive,    // è¢«åŠ¨ä¿®ç‚¼ï¼ˆåœ¨ç‰¹å®šäº‹ä»¶æ—¶è§¦å‘ï¼‰
    Continuous  // æŒç»­ä¿®ç‚¼ï¼ˆå¦‚å›½è¿ä¿®ç‚¼ï¼Œä¸å½±å“å…¶ä»–è¡Œä¸ºï¼‰
}

/// <summary>
/// è¢«åŠ¨ä¿®ç‚¼è§¦å‘äº‹ä»¶ç±»å‹
/// </summary>
public enum PassiveTriggerEvents
{
    OnKill,         // å‡»æ€æ—¶è§¦å‘
    OnAttack,       // æ”»å‡»æ—¶è§¦å‘
    OnBeAttacked,   // è¢«æ”»å‡»æ—¶è§¦å‘
    OnGoodDeed,     // è¡Œå–„æ—¶è§¦å‘
    OnWinBattle,    // æˆ˜æ–—èƒœåˆ©æ—¶è§¦å‘
    OnBuild,        // å»ºé€ æ—¶è§¦å‘
    OnCraft,        // åˆ¶ä½œæ—¶è§¦å‘
    OnTrade,        // äº¤æ˜“æ—¶è§¦å‘
}
```

**æ³¨æ„**: `PassiveTriggerEvents` å­—æ®µä½¿ç”¨ `HashSet<PassiveTriggerEvents>` ç±»å‹ï¼Œæ”¯æŒå¤šä¸ªè§¦å‘äº‹ä»¶ç»„åˆï¼ˆå¦‚æˆ˜æ–—ä¿®ç‚¼å¯ä»¥åŒæ—¶è§¦å‘ OnAttack å’Œ OnBeAttackedï¼‰ã€‚
```

### 3.4 ä¿®ç‚¼æ–¹å¼é›†åˆ (CultivateMethods)

```csharp
public class CultivateMethods : ExtendLibrary<CultivateMethodAsset, CultivateMethods>
{
    /// <summary>
    /// æ ‡å‡†é—­å…³ä¿®ç‚¼æ–¹å¼
    /// </summary>
    public static CultivateMethodAsset Standard { get; private set; }

    protected override bool AutoRegisterAssets() => true;

    protected override void OnInit()
    {
        Standard.TriggerType = CultivateTriggerType.Active;
        Standard.CanCultivate = ae => ae.HasCultisys<Xian>();
        Standard.GetEfficiency = ae => ae.HasElementRoot() ? ae.GetElementRoot().GetStrength() : 1f;
        Standard.GetBehaviourJobId = ae => {
            if (ae.Base.hasHouse())
            {
                return ActorJobs.XianCultivator.id;
            }
            else
            {
                return ActorJobs.PlantXianCultivator.id;
            }
        };
    }
}
```

**æ³¨æ„**: ä¿®ç‚¼æ–¹å¼é€šè¿‡ `GetBehaviourJobId` å§”æ‰˜æŒ‡å®šå¯¹åº”çš„AIè¡Œä¸ºä»»åŠ¡ï¼Œå®é™…çš„ä¿®ç‚¼é€»è¾‘ï¼ˆå¦‚å¸æ”¶çµæ°”ã€å¢åŠ çµåŠ›ç­‰ï¼‰ç”±å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡å®ç°ã€‚è¿™ç§æ–¹å¼æ›´åŠ çµæ´»ï¼Œå…è®¸ä¸åŒä¿®ç‚¼æ–¹å¼ä½¿ç”¨ä¸åŒçš„è¡Œä¸ºé€»è¾‘ã€‚

### 3.5 SkillPoolEntry (æ³•æœ¯æ± æ¡ç›®)

```csharp
public struct SkillPoolEntry
{
    public string SkillEntityAssetId;    // æŠ€èƒ½èµ„æºID
    public float BaseChance;             // åŸºç¡€é¢†æ‚Ÿæ¦‚ç‡
    public float MasteryThreshold;       // éœ€è¦çš„æŒæ¡ç¨‹åº¦é˜ˆå€¼
    public int LevelRequirement;         // éœ€è¦çš„å¢ƒç•Œ
}
```

### 3.6 ActorCultibookState (è§’è‰²åŠŸæ³•çŠ¶æ€ç»„ä»¶)

```csharp
public struct ActorCultibookState : IComponent
{
    // ä¸»ä¿®åŠŸæ³•
    public string MainCultibookId;       // ä¸»ä¿®åŠŸæ³•ID
    public float MainMastery;            // ä¸»ä¿®æŒæ¡ç¨‹åº¦
    public float AccumulatedTime;        // ç´¯è®¡ä¿®ç‚¼æ—¶é—´
    
    // æ³•æœ¯é¢†æ‚Ÿè¿›åº¦
    public Dictionary<string, float> SkillProgress;  // å„æ³•æœ¯çš„é¢†æ‚Ÿè¿›åº¦
}
```

### 3.7 CultibookKnowledge (åŠŸæ³•äº†è§£å…³ç³»)

```csharp
public struct CultibookKnowledge : ILinkRelation
{
    public string CultibookId;           // åŠŸæ³•ID
    public float KnowledgeLevel;         // äº†è§£ç¨‹åº¦ï¼ˆç”¨äºæŠ„å½•è´¨é‡ï¼‰
    public bool IsMain;                  // æ˜¯å¦ä¸ºä¸»ä¿®
    
    public Entity GetRelationKey();
}
```

---

## åŠŸæ³•åˆ†ç±»ä½“ç³»

### 4.1 å“é˜¶åˆ†ç±»

| å“é˜¶ | æ‰è½æƒé‡ | å±æ€§åŠ æˆå€ç‡ | æ³•æœ¯æ± æ•°é‡ | æè¿° |
|-----|---------|------------|----------|------|
| äººçº§ | 60% | 1.0x | 1-2 | å…¥é—¨åŠŸæ³•ï¼Œæ˜“å­¦éš¾ç²¾ |
| åœ°çº§ | 25% | 2.0x | 2-4 | ä¸­é˜¶åŠŸæ³•ï¼Œéœ€ä¸€å®šå¤©èµ‹ |
| å¤©çº§ | 12% | 4.0x | 4-6 | é«˜é˜¶åŠŸæ³•ï¼Œæ•ˆæœæ˜¾è‘— |
| ä»™çº§ | 3% | 8.0x | 6-10 | é¡¶çº§åŠŸæ³•ï¼Œä¸‡ä¸­æ— ä¸€ |

### 4.2 å±æ€§æµæ´¾

#### äº”è¡ŒåŠŸæ³•

| æµæ´¾ | çµæ ¹è¦æ±‚ | ä¸»è¦åŠ æˆ | ä»£è¡¨ä¿®ç‚¼æ–¹å¼ |
|-----|---------|---------|------------|
| é‡‘ç³» | Iron > 0.5 | æ”»å‡»ã€æŠ¤ç”² | æˆ˜æ–—ä¿®ç‚¼ |
| æœ¨ç³» | Wood > 0.5 | ç”Ÿå‘½ã€æ¢å¤ | æ—ä¸­å…±ä¿® |
| æ°´ç³» | Water > 0.5 | é€Ÿåº¦ã€çµå·§ | æ°´ä¸­ä¿®ç‚¼ |
| ç«ç³» | Fire > 0.5 | æš´å‡»ã€çˆ†å‘ | æˆ˜æ–—ä¿®ç‚¼ |
| åœŸç³» | Earth > 0.5 | é˜²å¾¡ã€ç¨³å›º | å±±å·…ä¿®ç‚¼ |

#### é˜´é˜³åŠŸæ³•

| æµæ´¾ | çµæ ¹è¦æ±‚ | ä¸»è¦åŠ æˆ | ä»£è¡¨ä¿®ç‚¼æ–¹å¼ |
|-----|---------|---------|------------|
| é˜´ç³» | Neg > 0.5 | é—ªé¿ã€æš—æ€ | å¤œé—´ä¿®ç‚¼ |
| é˜³ç³» | Pos > 0.5 | æ¢å¤ã€ç¥ç¦ | æ—¥é—´ä¿®ç‚¼ |

#### ç‰¹æ®Šæµæ´¾

| æµæ´¾ | è¦æ±‚ | ä¸»è¦ç‰¹ç‚¹ | ä¿®ç‚¼æ–¹å¼ |
|-----|-----|---------|---------|
| é­”é“ | æ€ç”Ÿè®°å½• | é€Ÿæˆã€é£é™©é«˜ | æ€æˆ®å¸æ”¶ |
| å¸é“ | æ˜¯å›½ç‹/é¢†ä¸» | å›½è¿åŠ æˆ | å›½è¿ä¿®ç‚¼ |
| ä½›é“ | åŠŸå¾·å€¼ | ç¨³å¥ã€æ¸¡åŠ«æ˜“ | åŠŸå¾·ç§¯ç´¯ |

### 4.3 å†²çªæ ‡ç­¾ä½“ç³»

```
æ­£é“æ ‡ç­¾: ["righteous", "orthodox"]
é­”é“æ ‡ç­¾: ["demonic", "evil"]
ä½›é“æ ‡ç­¾: ["buddhist", "peaceful"]
æ€é“æ ‡ç­¾: ["killing", "battle"]
```

- æ‹¥æœ‰ "righteous" æ ‡ç­¾çš„åŠŸæ³•ä¸ "demonic" æ ‡ç­¾çš„åŠŸæ³•å†²çª
- å†²çªåŠŸæ³•**ä¸èƒ½åŒæ—¶ä½œä¸ºä¸»ä¿®å’Œäº†è§£**
- å°è¯•å­¦ä¹ å†²çªåŠŸæ³•ä¼šå¯¼è‡´å¿ƒé­”ï¼ˆDebuffï¼‰

---

## ä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ

### 5.1 ä¿®ç‚¼æ–¹å¼Assetå®šä¹‰ç¤ºä¾‹

æ‰€æœ‰ä¿®ç‚¼æ–¹å¼éƒ½æ˜¯ `CultivateMethodAsset`ï¼Œé€šè¿‡å§”æ‰˜å®šä¹‰å„è‡ªçš„è¡Œä¸ºé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯å„ç§ä¿®ç‚¼æ–¹å¼çš„å…·ä½“å®ç°ï¼š

#### 5.1.1 Standard (æ ‡å‡†é—­å…³ä¿®ç‚¼)

```csharp
protected override void OnInit()
{
    Standard.TriggerType = CultivateTriggerType.Active;
    Standard.CanCultivate = ae => ae.HasCultisys<Xian>();
    Standard.GetEfficiency = ae => ae.HasElementRoot() ? ae.GetElementRoot().GetStrength() : 1f;
    Standard.GetBehaviourJobId = ae => {
        if (ae.Base.hasHouse())
        {
            return ActorJobs.XianCultivator.id;
        }
        else
        {
            return ActorJobs.PlantXianCultivator.id;
        }
    };
}
```

**è¯´æ˜**: æ ‡å‡†ä¿®ç‚¼æ–¹å¼é€šè¿‡ `GetBehaviourJobId` å§”æ‰˜è¿”å›å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡IDã€‚å¦‚æœè§’è‰²æœ‰ä½æ‰€ï¼Œä½¿ç”¨ `XianCultivator` ä»»åŠ¡ï¼ˆåœ¨å®¶ä¿®ç‚¼ï¼‰ï¼›å¦åˆ™ä½¿ç”¨ `PlantXianCultivator` ä»»åŠ¡ï¼ˆæ¤ç‰©å½¢æ€ä¿®ç‚¼ï¼‰ã€‚å®é™…çš„ä¿®ç‚¼é€»è¾‘ï¼ˆå¸æ”¶çµæ°”ã€å¢åŠ çµåŠ›ç­‰ï¼‰åœ¨å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡ä¸­å®ç°ã€‚

#### 5.1.2 WaterMeditation (æ°´ä¸­ä¿®ç‚¼)

```csharp
protected override void OnInit()
{
    // ... Standard é…ç½® ...
    
    WaterMeditation.TriggerType = CultivateTriggerType.Active;
    WaterMeditation.CanCultivate = ae => ae.Base.current_tile.isWater();
    WaterMeditation.GetEfficiency = ae => 
    {
        if (!ae.Base.current_tile.isWater()) return 0.5f;
        // æ°´ä¸­æ•ˆç‡æå‡ï¼Œä¸”ä¸æ°´ç³»çµæ ¹æˆæ­£æ¯”
        return 1.5f * (ae.HasElementRoot() ? ae.GetElementRoot().Water : 1f);
    };
    WaterMeditation.GetBehaviourJobId = ae => ActorJobs.WaterCultivator.id; // å‡è®¾å­˜åœ¨æ­¤ä»»åŠ¡
}
```

**è¯´æ˜**: æ°´ä¸­ä¿®ç‚¼éœ€è¦è§’è‰²åœ¨æ°´ä¸­æ‰èƒ½è¿›è¡Œã€‚ä¿®ç‚¼æ•ˆç‡åœ¨æ°´ä¸­ä¼šæå‡ï¼ˆ1.5xï¼‰ï¼Œä¸”ä¸æ°´ç³»çµæ ¹å¼ºåº¦æˆæ­£æ¯”ã€‚éœ€è¦åˆ›å»ºä¸“é—¨çš„ `WaterCultivator` è¡Œä¸ºä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡è´Ÿè´£å¯»æ‰¾æ°´åŸŸã€ç§»åŠ¨åˆ°æ°´åŸŸï¼Œå¹¶åœ¨æ°´ä¸­æ‰§è¡Œä¿®ç‚¼é€»è¾‘ã€‚

#### 5.1.3 KillAbsorb (æ€æˆ®å¸æ”¶ - é­”é“)

```csharp
protected override void OnInit()
{
    // ... å…¶ä»–é…ç½® ...
    
    KillAbsorb.TriggerType = CultivateTriggerType.Passive;
    KillAbsorb.PassiveTriggerEvents.Add(PassiveTriggerEvents.OnKill);
    KillAbsorb.CanCultivate = ae => true; // åªè¦æ€äº†å°±èƒ½ä¿®ç‚¼
    KillAbsorb.GetEfficiency = ae =>
    {
        // æ€å¾—è¶Šå¤šæ•ˆç‡è¶Šé«˜ï¼Œä½†ä¹Ÿè¶Šå®¹æ˜“å¿ƒé­”
        var killCount = ae.Base.data.get("kill_count", 0);
        return 1f + Mathf.Log10(killCount + 1) * 0.5f;
    };
    KillAbsorb.OnSideEffect = (ae, wakanGained) =>
    {
        // ç§¯ç´¯æ€ä¸š
        var karma = ae.Base.data.get("karma", 0f);
        karma -= wakanGained * 0.1f; // è´Ÿå€¼ä¸ºæ¶ä¸š
        ae.Base.data.set("karma", karma);
        
        // æ€ä¸šè¿‡é‡å¯èƒ½è§¦å‘å¿ƒé­”
        if (karma < -100 && Randy.randomChance(0.01f))
        {
            ae.Base.addTrait("inner_demon"); // è§¦å‘å¿ƒé­”çŠ¶æ€
        }
    };
    // è¢«åŠ¨ä¿®ç‚¼ä¸éœ€è¦ GetBehaviourJobId
}
```

**è¯´æ˜**: æ€æˆ®å¸æ”¶æ˜¯è¢«åŠ¨ä¿®ç‚¼æ–¹å¼ï¼Œåœ¨å‡»æ€æ—¶è§¦å‘ï¼ˆé€šè¿‡ `PassiveTriggerEvents.Add(PassiveTriggerEvents.OnKill)`ï¼‰ã€‚å®é™…çš„çµåŠ›è·å–å’Œå‰¯ä½œç”¨å¤„ç†åœ¨äº‹ä»¶è§¦å‘ç³»ç»Ÿä¸­å®ç°ï¼Œæ— éœ€ä¸“é—¨çš„ `GetBehaviourJobId`ã€‚

#### 5.1.4 KingdomFortune (å›½è¿ä¿®ç‚¼ - å¸é“)

```csharp
protected override void OnInit()
{
    // ... å…¶ä»–é…ç½® ...
    
    KingdomFortune.TriggerType = CultivateTriggerType.Continuous;
    KingdomFortune.CanCultivate = ae => ae.Base.isKing() || ae.Base.isCityLeader();
    KingdomFortune.GetEfficiency = ae =>
    {
        if (!ae.Base.isKing()) return 0.5f; // åŸä¸»æ•ˆç‡å‡åŠ
        return 1.0f;
    };
    KingdomFortune.OnSideEffect = (ae, wakanGained) =>
    {
        // å¸æ”¶å›½è¿å¯èƒ½å½±å“å›½å®¶æ°”è¿
        // è¿™é‡Œå¯ä»¥å®ç°å›½è¿å‡å°‘çš„é€»è¾‘
    };
    // æŒç»­ä¿®ç‚¼ç”±ä¸“é—¨çš„ç³»ç»Ÿå¤„ç†ï¼Œä¸éœ€è¦ GetBehaviourJobId
}
```

**è¯´æ˜**: å›½è¿ä¿®ç‚¼æ˜¯æŒç»­ä¿®ç‚¼æ–¹å¼ï¼ˆ`Continuous`ï¼‰ï¼Œç”±ä¸“é—¨çš„ `ContinuousCultivateSystem` ç³»ç»Ÿæ¯å¸§è‡ªåŠ¨å¤„ç†ã€‚ç³»ç»Ÿä¼šæ ¹æ®å›½è¿å¤§å°è®¡ç®—çµåŠ›æ”¶ç›Šï¼Œæ— éœ€ä¸“é—¨çš„AIè¡Œä¸ºä»»åŠ¡ã€‚å®é™…çš„çµåŠ›è®¡ç®—åœ¨æŒç»­ä¿®ç‚¼ç³»ç»Ÿä¸­å®ç°ã€‚

#### 5.1.5 BattleCultivate (æˆ˜æ–—ä¿®ç‚¼)

```csharp
protected override void OnInit()
{
    // ... å…¶ä»–é…ç½® ...
    
    BattleCultivate.TriggerType = CultivateTriggerType.Passive;
    BattleCultivate.PassiveTriggerEvents.Add(PassiveTriggerEvents.OnAttack);
    BattleCultivate.PassiveTriggerEvents.Add(PassiveTriggerEvents.OnBeAttacked);
    BattleCultivate.CanCultivate = ae => ae.Base.isInCombat();
    BattleCultivate.GetEfficiency = ae =>
    {
        // æˆ˜æ–—è¶Šæ¿€çƒˆæ•ˆç‡è¶Šé«˜
        var combatIntensity = ae.Base.data.get("combat_intensity", 1f);
        return combatIntensity;
    };
    BattleCultivate.OnSideEffect = (ae, wakanGained) =>
    {
        // æˆ˜æ–—ä¿®ç‚¼å¢åŠ æˆ˜æ–—ç»éªŒ
        ae.Base.data.add("battle_experience", wakanGained);
    };
    // è¢«åŠ¨ä¿®ç‚¼ä¸éœ€è¦ GetBehaviourJobId
}
```

**è¯´æ˜**: æˆ˜æ–—ä¿®ç‚¼æ˜¯è¢«åŠ¨ä¿®ç‚¼æ–¹å¼ï¼Œåœ¨æ”»å‡»æˆ–è¢«æ”»å‡»æ—¶è§¦å‘ã€‚å®é™…çš„çµåŠ›è·å–åœ¨äº‹ä»¶è§¦å‘ç³»ç»Ÿä¸­å®ç°ï¼Œæ ¹æ®ä¼¤å®³å€¼è®¡ç®—ã€‚

#### 5.1.6 MeritAccumulate (åŠŸå¾·ä¿®ç‚¼ - ä½›é“)

```csharp
protected override void OnInit()
{
    // ... å…¶ä»–é…ç½® ...
    
    MeritAccumulate.TriggerType = CultivateTriggerType.Passive;
    MeritAccumulate.PassiveTriggerEvents.Add(PassiveTriggerEvents.OnGoodDeed); // è¡Œå–„æ—¶è§¦å‘
    MeritAccumulate.CanCultivate = ae =>
    {
        var karma = ae.Base.data.get("karma", 0f);
        return karma >= 0; // éœ€è¦æ— æ¶ä¸šæ‰èƒ½ä¿®ç‚¼
    };
    MeritAccumulate.GetEfficiency = ae =>
    {
        var karma = ae.Base.data.get("karma", 0f);
        return 1f + karma * 0.01f; // åŠŸå¾·è¶Šå¤šæ•ˆç‡è¶Šé«˜
    };
    MeritAccumulate.OnSideEffect = (ae, wakanGained) =>
    {
        // åŠŸå¾·ä¿®ç‚¼å¢åŠ karma
        var karma = ae.Base.data.get("karma", 0f);
        karma += wakanGained * 0.5f;
        ae.Base.data.set("karma", karma);
        
        // åŠŸå¾·æ·±åšè€…æ¸¡åŠ«æ›´å®¹æ˜“
        if (karma > 100)
        {
            ae.Base.addTrait("merit_protection");
        }
    };
    // è¢«åŠ¨ä¿®ç‚¼ä¸éœ€è¦ GetBehaviourJobId
}
```

**è¯´æ˜**: åŠŸå¾·ä¿®ç‚¼æ˜¯è¢«åŠ¨ä¿®ç‚¼æ–¹å¼ï¼Œåœ¨è¡Œå–„æ—¶è§¦å‘ï¼ˆé€šè¿‡ `PassiveTriggerEvents.Add(PassiveTriggerEvents.OnGoodDeed)`ï¼‰ã€‚å®é™…çš„çµåŠ›è·å–å’ŒåŠŸå¾·ç§¯ç´¯åœ¨äº‹ä»¶è§¦å‘ç³»ç»Ÿä¸­å®ç°ã€‚

### 5.2 ä¿®ç‚¼æ–¹å¼æ³¨å†Œ

```csharp
public class CultivateMethods : ExtendLibrary<CultivateMethodAsset, CultivateMethods>
{
    public static CultivateMethodAsset Standard { get; private set; }
    public static CultivateMethodAsset WaterMeditation { get; private set; }
    public static CultivateMethodAsset MountainAbsorb { get; private set; }
    public static CultivateMethodAsset ForestCommunion { get; private set; }
    public static CultivateMethodAsset BattleCultivate { get; private set; }
    public static CultivateMethodAsset KillAbsorb { get; private set; }
    public static CultivateMethodAsset BloodRefine { get; private set; }
    public static CultivateMethodAsset KingdomFortune { get; private set; }
    public static CultivateMethodAsset FaithPower { get; private set; }
    public static CultivateMethodAsset MeritAccumulate { get; private set; }
    
    protected override void OnInit()
    {
        // åˆå§‹åŒ–å„ä¿®ç‚¼æ–¹å¼çš„å§”æ‰˜...
    }
}
```

### 5.3 ä¿®ç‚¼æ–¹å¼è§¦å‘é›†æˆ

ç®€åŒ–åçš„ä¿®ç‚¼æ–¹å¼ç³»ç»Ÿå°†ä¿®ç‚¼é€»è¾‘é›†ä¸­åœ¨è¡Œä¸ºä»»åŠ¡ï¼ˆBehaviourJobï¼‰å’Œç³»ç»Ÿï¼ˆSystemï¼‰ä¸­ï¼š

- **ä¸»åŠ¨ä¿®ç‚¼ï¼ˆActiveï¼‰**: é€šè¿‡ `GetBehaviourJobId` è¿”å›å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡IDï¼Œç”±è¯¥è¡Œä¸ºä»»åŠ¡æ‰§è¡Œå®Œæ•´çš„ä¿®ç‚¼é€»è¾‘ï¼ˆæ£€æŸ¥æ¡ä»¶ã€å¸æ”¶çµæ°”ã€å¢åŠ çµåŠ›ç­‰ï¼‰
- **è¢«åŠ¨ä¿®ç‚¼ï¼ˆPassiveï¼‰**: é€šè¿‡äº‹ä»¶ç³»ç»Ÿè§¦å‘ï¼Œåœ¨å¯¹åº”çš„äº‹ä»¶å¤„ç†ä¸­è®¡ç®—æ”¶ç›Šå¹¶è°ƒç”¨ `OnSideEffect`
- **æŒç»­ä¿®ç‚¼ï¼ˆContinuousï¼‰**: ç”±ä¸“é—¨çš„ç³»ç»Ÿï¼ˆå¦‚ `ContinuousCultivateSystem`ï¼‰æ¯å¸§è‡ªåŠ¨å¤„ç†

```csharp
// åœ¨äº‹ä»¶ç³»ç»Ÿä¸­æ³¨å†Œè¢«åŠ¨ä¿®ç‚¼è§¦å‘
public static class CultivateMethodTriggers
{
    public static void Init()
    {
        // å‡»æ€è§¦å‘
        ActorExtend.RegisterActionOnKill((killer, victim) =>
        {
            var mainCultibook = killer.GetMainCultibook();
            if (mainCultibook == null) return;
            
            var method = mainCultibook.GetCultivateMethod();
            if (method.TriggerType != CultivateTriggerType.Passive) return;
            if (method.PassiveTriggerEvents == null || 
                !method.PassiveTriggerEvents.Contains(PassiveTriggerEvents.OnKill)) return;
            
            // è®¡ç®—ä¿®ç‚¼æ”¶ç›Šï¼ˆåœ¨äº‹ä»¶å¤„ç†ä¸­å®ç°ï¼‰
            ref var xian = ref killer.GetCultisys<Xian>();
            var victimPower = victim.Base.stats[S.power];
            var efficiency = method.GetEfficiency?.Invoke(killer) ?? 1f;
            var gain = victimPower * 0.1f * efficiency; // æ”¶ç›Šè®¡ç®—é€»è¾‘
            
            xian.wakan += gain;
            method.OnSideEffect?.Invoke(killer, gain);
        });
        
    }
}
```

**æ³¨æ„**: 
- `CultivateMethodTriggers.Init()` åœ¨ `Content.Manager.Init()` ä¸­è°ƒç”¨ï¼Œæ³¨å†Œæ‰€æœ‰è¢«åŠ¨è§¦å‘äº‹ä»¶
- `ContinuousCultivateSystem` åœ¨ `Content.Manager.Init()` ä¸­æ·»åŠ åˆ° `GeneralLogicSystems`ï¼Œå¹¶å·²ä½¿ç”¨ `ContinuousCultivateTag` è¿›è¡Œæ€§èƒ½ä¼˜åŒ–
- æ‰€æœ‰è¢«åŠ¨è§¦å‘äº‹ä»¶å¤„ç†å·²å®ç°ï¼šOnKillã€OnAttackã€OnBeAttacked

---

## æ³•æœ¯æ± ç³»ç»Ÿ

### 6.1 æ³•æœ¯é¢†æ‚Ÿæœºåˆ¶

ä¿®ç‚¼ä¸»ä¿®åŠŸæ³•æ—¶ï¼Œæœ‰æœºä¼šé¢†æ‚Ÿå…¶ä¸­çš„æ³•æœ¯ï¼š

1. **é¢†æ‚Ÿæ¦‚ç‡è®¡ç®—**:
```
é¢†æ‚Ÿæ¦‚ç‡ = åŸºç¡€æ¦‚ç‡ Ã— æŒæ¡ç¨‹åº¦ç³»æ•° Ã— æ™ºåŠ›ç³»æ•° Ã— çµæ ¹å¥‘åˆåº¦
```

2. **é¢†æ‚Ÿæ¡ä»¶**:
   - æŒæ¡ç¨‹åº¦è¾¾åˆ°æ³•æœ¯è¦æ±‚çš„é˜ˆå€¼
   - å¢ƒç•Œè¾¾åˆ°æ³•æœ¯è¦æ±‚
   - å½“å‰æœªå­¦ä¹ è¯¥æ³•æœ¯

3. **é¢†æ‚Ÿæ—¶æœº**:
   - å®Œæˆä¸€æ¬¡å®Œæ•´ä¿®ç‚¼å
   - æŒæ¡ç¨‹åº¦çªç ´å…³é”®èŠ‚ç‚¹æ—¶ï¼ˆ20%/40%/60%/80%/100%ï¼‰

### 6.2 æ³•æœ¯æ± é…ç½®ç¤ºä¾‹

```json
{
    "cultibook_id": "water_basic",
    "skill_pool": [
        {
            "skill_id": "water_arrow",
            "base_chance": 0.3,
            "mastery_threshold": 20,
            "level_requirement": 1
        },
        {
            "skill_id": "water_shield",
            "base_chance": 0.2,
            "mastery_threshold": 40,
            "level_requirement": 2
        },
        {
            "skill_id": "water_dragon",
            "base_chance": 0.05,
            "mastery_threshold": 80,
            "level_requirement": 3
        }
    ]
}
```

---

## AIè¡Œä¸ºè®¾è®¡

### 7.1 åŠŸæ³•ç›¸å…³AIè¡Œä¸º

#### BehChooseCultibook (é€‰æ‹©åŠŸæ³•)
- **è§¦å‘æ¡ä»¶**: æ— ä¸»ä¿®åŠŸæ³•ä¸”æœ‰å¯å­¦ä¹ çš„åŠŸæ³•
- **è¡Œä¸ºé€»è¾‘**:
  1. è·å–æ‰€æœ‰å¯å­¦ä¹ çš„åŠŸæ³•ï¼ˆä¹¦ç±ã€å¸ˆæ‰¿ï¼‰
  2. ç­›é€‰ç¬¦åˆçµæ ¹éœ€æ±‚çš„åŠŸæ³•
  3. æ ¹æ®å“é˜¶ã€å¥‘åˆåº¦è¯„åˆ†
  4. é€‰æ‹©è¯„åˆ†æœ€é«˜çš„åŠŸæ³•ä½œä¸ºä¸»ä¿®

#### BehStudyCultibook (ç ”ä¹ åŠŸæ³•)
- **è§¦å‘æ¡ä»¶**: æœ‰ä¸»ä¿®åŠŸæ³•ï¼ŒæŒæ¡ç¨‹åº¦ < 100%
- **è¡Œä¸ºé€»è¾‘**:
  1. æ‰§è¡Œå¯¹åº”ä¿®ç‚¼æ–¹å¼çš„è¡Œä¸º
  2. å¢åŠ æŒæ¡ç¨‹åº¦
  3. æ£€æŸ¥æ˜¯å¦å¯ä»¥é¢†æ‚Ÿæ³•æœ¯
  4. è§¦å‘æ³•æœ¯é¢†æ‚Ÿåˆ¤å®š

#### BehSwitchCultibook (è½¬ä¿®åŠŸæ³•)
- **è§¦å‘æ¡ä»¶**: æœ‰æ›´å¥½çš„åŠŸæ³•é€‰æ‹©ï¼Œä¸”å½“å‰åŠŸæ³•æŒæ¡ç¨‹åº¦è¾ƒä½
- **è¡Œä¸ºé€»è¾‘**:
  1. è¯„ä¼°è½¬ä¿®æ”¶ç›Š
  2. è®¡ç®—è½¬ä¿®æˆåŠŸç‡
  3. æ‰§è¡Œè½¬ä¿®åˆ¤å®š
  4. å¤„ç†è½¬ä¿®ç»“æœ

#### BehTeachCultibook (ä¼ æˆåŠŸæ³•)
- **è§¦å‘æ¡ä»¶**: æœ‰å¼Ÿå­/å®—é—¨æˆå‘˜ï¼Œä¸”å¯¹æ–¹æ— ä¸»ä¿®åŠŸæ³•
- **è¡Œä¸ºé€»è¾‘**:
  1. æ‰¾åˆ°éœ€è¦ä¼ æˆçš„å¯¹è±¡
  2. å°†åŠŸæ³•ä¼ æˆç»™å¯¹æ–¹
  3. å»ºç«‹å¸ˆæ‰¿å…³ç³»

### 7.2 ä¿®ç‚¼æ–¹å¼ä¸“å±è¡Œä¸º

#### BehWaterCultivate (æ°´ä¸­ä¿®ç‚¼)
```csharp
public class BehWaterCultivate : BehaviourActionActor
{
    public override BehResult execute(Actor pObject)
    {
        // æ£€æŸ¥æ˜¯å¦åœ¨æ°´ä¸­
        if (!pObject.current_tile.isWater())
        {
            // å¯»æ‰¾é™„è¿‘çš„æ°´åŸŸ
            var water_tile = FindNearbyWater(pObject);
            if (water_tile == null) return BehResult.Stop;
            
            pObject.goTo(water_tile);
            return BehResult.RepeatStep;
        }
        
        // æ‰§è¡Œæ°´ä¸­ä¿®ç‚¼
        var ae = pObject.GetExtend();
        ref var xian = ref ae.GetCultisys<Xian>();
        
        // æ°´ä¸­ä¿®ç‚¼æ•ˆç‡æå‡50%
        var efficiency = 1.5f * ae.GetElementRoot().Water;
        CultivateWithEfficiency(ae, ref xian, efficiency);
        
        return BehResult.Continue;
    }
}
```

#### BehKillCultivate (æ€æˆ®ä¿®ç‚¼)
```csharp
public class BehKillCultivate : BehaviourActionActor
{
    public override BehResult execute(Actor pObject)
    {
        var ae = pObject.GetExtend();
        
        // å¯»æ‰¾ç›®æ ‡
        var target = FindKillTarget(pObject);
        if (target == null) return BehResult.Stop;
        
        // æ”»å‡»ç›®æ ‡
        if (!pObject.isInAttackRange(target))
        {
            pObject.goTo(target);
            return BehResult.RepeatStep;
        }
        
        pObject.attackTarget(target);
        
        // å¦‚æœç›®æ ‡æ­»äº¡ï¼Œå¸æ”¶çµåŠ›
        if (!target.data.alive)
        {
            ref var xian = ref ae.GetCultisys<Xian>();
            var absorbed = CalculateAbsorbedWakan(target);
            xian.wakan += absorbed;
            
            // ç§¯ç´¯æ€ä¸š
            ae.AddKarma(-absorbed * 0.1f);
        }
        
        return BehResult.Continue;
    }
}
```

#### BehKingdomCultivate (å›½è¿ä¿®ç‚¼)
```csharp
public class BehKingdomCultivate : BehaviourActionActor
{
    public override BehResult execute(Actor pObject)
    {
        if (!pObject.isKing()) return BehResult.Stop;
        
        var ae = pObject.GetExtend();
        ref var xian = ref ae.GetCultisys<Xian>();
        
        // è®¡ç®—å›½è¿
        var fortune = CalculateKingdomFortune(pObject);
        
        // ä»å›½è¿ä¸­è·å–çµåŠ›ï¼ˆä¸å½±å“æ­£å¸¸å›½ç‹è¡Œä¸ºï¼‰
        xian.wakan += fortune * 0.001f;
        
        return BehResult.Continue;
    }
}
```

### 7.3 ä»»åŠ¡ä¸æ¡ä»¶

```csharp
// æ–°å¢ä»»åŠ¡
public static BehaviourTaskActor StudyCultibook { get; private set; }
public static BehaviourTaskActor WaterCultivate { get; private set; }
public static BehaviourTaskActor KillCultivate { get; private set; }
public static BehaviourTaskActor KingdomCultivate { get; private set; }

// æ–°å¢æ¡ä»¶
public class CondHasMainCultibook : BehConditionActor { }
public class CondNeedStudyCultibook : BehConditionActor { }
public class CondCanSwitchCultibook : BehConditionActor { }
public class CondIsWaterCultivator : BehConditionActor { }
public class CondIsKillCultivator : BehConditionActor { }
public class CondIsKingCultivator : BehConditionActor { }
```

---

## UIç•Œé¢è®¾è®¡

### 8.1 åŠŸæ³•ä¿¡æ¯é¡µé¢ (CultibookPage)

æ˜¾ç¤ºè§’è‰²çš„åŠŸæ³•ä¿¡æ¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€åŠŸæ³•ã€‘                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜… ä¸»ä¿®åŠŸæ³•                           â”‚
â”‚   åç§°: å¤ªç„çœŸç»                       â”‚
â”‚   å“é˜¶: å¤©çº§                          â”‚
â”‚   æŒæ¡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 82%              â”‚
â”‚   ä¿®ç‚¼æ–¹å¼: å±±å·…ä¿®ç‚¼                    â”‚
â”‚   å±æ€§åŠ æˆ:                           â”‚
â”‚     - æ”»å‡»åŠ› +24.6                   â”‚
â”‚     - çµåŠ›ä¸Šé™ +164.0                â”‚
â”‚   å¯é¢†æ‚Ÿæ³•æœ¯:                         â”‚
â”‚     âœ“ é‡‘å‰‘æœ¯ (å·²é¢†æ‚Ÿ)                 â”‚
â”‚     â—‹ é‡‘åˆƒé£æš´ (éœ€80%æŒæ¡)            â”‚
â”‚     â—‹ é‡‘èº«æœ¯ (éœ€100%æŒæ¡)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â—‹ äº†è§£åŠŸæ³•                           â”‚
â”‚   - æ°´çµè¯€ (30%)                     â”‚
â”‚   - åŸºç¡€å…»æ°”æœ¯ (45%)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 åŠŸæ³•ä¹¦ç•Œé¢ (CultibookTooltip)

é¼ æ ‡æ‚¬åœæ˜¾ç¤ºåŠŸæ³•ä¹¦ä¿¡æ¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€Šå¤ªç„çœŸç»ã€‹                          â”‚
â”‚ å“é˜¶: å¤©çº§ â˜…â˜…â˜…                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çµæ ¹éœ€æ±‚:                            â”‚
â”‚   é‡‘å…ƒç´  â‰¥ 0.6                       â”‚
â”‚ å¢ƒç•Œè¦æ±‚:                            â”‚
â”‚   ç­‘åŸºæœŸä»¥ä¸Š                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¿®ç‚¼æ–¹å¼: å±±å·…ä¿®ç‚¼                     â”‚
â”‚ åœ¨é«˜å¤„ä¿®ç‚¼å¯è·å¾—é¢å¤–æ”¶ç›Š                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ»¡æŒæ¡å±æ€§åŠ æˆ:                        â”‚
â”‚   æ”»å‡»åŠ› +30                         â”‚
â”‚   çµåŠ›ä¸Šé™ +200                       â”‚
â”‚   é‡‘ç³»äº²å’Œ +0.5                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯é¢†æ‚Ÿæ³•æœ¯:                           â”‚
â”‚   - é‡‘å‰‘æœ¯ (20%)                     â”‚
â”‚   - é‡‘åˆƒé£æš´ (60%)                   â”‚
â”‚   - é‡‘èº«æœ¯ (100%)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŠ„å½•è€…: å¼ ä¸‰ä¸°                        â”‚
â”‚ ä¼ æ‰¿: æ­¦å½“æ´¾                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯å®ç°

### 9.1 ç°æœ‰ä»£ç ä¿®æ”¹

#### CultibookAsset æ‰©å±•
```csharp
// ä¿®æ”¹ Source/Content/Libraries/CultibookAsset.cs
public class CultibookAsset : Asset, IDeleteWhenUnknown
{
    // ä¿ç•™åŸæœ‰å­—æ®µ
    public BaseStats FinalStats;
    public string Name;
    public ItemLevel Level;
    public int Current { get; set; } = 0;
    
    // æ–°å¢å­—æ®µ
    public string Description;
    public ElementRequirement ElementReq;
    public float ElementAffinityThreshold = 0.3f;
    public int MinLevel = 0;
    public int MaxLevel = 20;
    public string CultivateMethodId = "Standard";  // ä¿®ç‚¼æ–¹å¼Asset ID
    public List<SkillPoolEntry> SkillPool = new();
    public string[] ConflictTags = Array.Empty<string>();
    public string[] SynergyTags = Array.Empty<string>();
    
    // è·å–ä¿®ç‚¼æ–¹å¼Asset
    public CultivateMethodAsset GetCultivateMethod()
    {
        if (string.IsNullOrEmpty(CultivateMethodId))
        {
            CultivateMethodId = "Standard";
        }
        return Manager.CultivateMethodLibrary.get(CultivateMethodId);
    }
}
```

#### ActorCultibookState ç»„ä»¶
```csharp
// æ–°å¢ Source/Content/Components/ActorCultibookState.cs
public struct ActorCultibookState : IComponent
{
    public string MainCultibookId;
    public float MainMastery;
    public float AccumulatedTime;
    public Dictionary<string, float> SkillProgress;
    
    public bool HasMainCultibook => !string.IsNullOrEmpty(MainCultibookId);
    
    public CultibookAsset GetMainCultibook()
    {
        return Libraries.Manager.CultibookLibrary.get(MainCultibookId);
    }
}
```

#### ActorExtend æ‰©å±•æ–¹æ³•
```csharp
// æ‰©å±• Source/Content/Extensions/ActorExtendTools.cs

// è·å–ä¸»ä¿®åŠŸæ³•
public static CultibookAsset GetMainCultibook(this ActorExtend ae)
{
    if (!ae.TryGetComponent(out ActorCultibookState state)) return null;
    if (!state.HasMainCultibook) return null;
    return state.GetMainCultibook();
}

// è®¾ç½®ä¸»ä¿®åŠŸæ³•
public static void SetMainCultibook(this ActorExtend ae, CultibookAsset cultibook)
{
    ref var state = ref ae.GetOrAddComponent<ActorCultibookState>();
    state.MainCultibookId = cultibook.id;
    state.MainMastery = 0;
    state.AccumulatedTime = 0;
}

// è½¬ä¿®åŠŸæ³•
public static bool TrySwitchMainCultibook(this ActorExtend ae, CultibookAsset newCultibook)
{
    ref var state = ref ae.GetOrAddComponent<ActorCultibookState>();
    var oldCultibook = state.GetMainCultibook();
    
    // è®¡ç®—è½¬ä¿®æˆåŠŸç‡
    float successRate = CalculateSwitchSuccessRate(ae, newCultibook);
    
    if (!Randy.randomChance(successRate))
    {
        // è½¬ä¿®å¤±è´¥ï¼ŒæŸå¤±çµåŠ›
        ref var xian = ref ae.GetCultisys<Xian>();
        xian.wakan *= 0.5f;
        return false;
    }
    
    // è½¬ä¿®æˆåŠŸ
    if (oldCultibook != null)
    {
        // å°†åŸä¸»ä¿®å˜ä¸ºäº†è§£
        ae.Master(oldCultibook, state.MainMastery * 0.5f);
    }
    
    state.MainCultibookId = newCultibook.id;
    state.MainMastery = ae.GetMaster(newCultibook) * 0.8f; // äº†è§£ç¨‹åº¦éƒ¨åˆ†è½¬åŒ–
    state.AccumulatedTime = 0;
    
    return true;
}

// è®¡ç®—è½¬ä¿®æˆåŠŸç‡
private static float CalculateSwitchSuccessRate(ActorExtend ae, CultibookAsset newCultibook)
{
    float baseRate = 0.7f;
    float intelligenceBonus = ae.GetStat(S.intelligence) / 100f * 0.2f;
    float affinityBonus = newCultibook.ElementReq.GetAffinity(ae.GetElementRoot()) * 0.1f;
    
    return Mathf.Clamp01(baseRate + intelligenceBonus + affinityBonus);
}

// å°è¯•é¢†æ‚Ÿæ³•æœ¯
public static bool TryComprehendSkill(this ActorExtend ae)
{
    var mainCultibook = ae.GetMainCultibook();
    if (mainCultibook == null) return false;
    
    ref var state = ref ae.GetComponent<ActorCultibookState>();
    
    foreach (var entry in mainCultibook.SkillPool)
    {
        if (state.MainMastery < entry.MasteryThreshold) continue;
        if (ae.HasSkill(entry.SkillEntityAssetId)) continue;
        
        float chance = entry.BaseChance 
            * (state.MainMastery / 100f)
            * (ae.GetStat(S.intelligence) / 50f);
        
        if (Randy.randomChance(chance))
        {
            ae.LearnSkillFromCultibook(entry.SkillEntityAssetId);
            return true;
        }
    }
    
    return false;
}
```

### 9.2 æ–°å¢æ–‡ä»¶åˆ—è¡¨

```
Source/Content/
â”œâ”€â”€ Components/
â”‚   â”œâ”€â”€ ActorCultibookState.cs      # è§’è‰²åŠŸæ³•çŠ¶æ€ç»„ä»¶
â”‚   â”œâ”€â”€ ContinuousCultivateTag.cs   # æŒç»­ä¿®ç‚¼æ ‡è®°ç»„ä»¶ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
â”‚   â””â”€â”€ CultibookKnowledge.cs       # åŠŸæ³•äº†è§£å…³ç³»
â”œâ”€â”€ AIGC/
â”‚   â””â”€â”€ CultibookLLMGenerator.cs    # è°ƒç”¨LLMç”ŸæˆåŠŸæ³•è“å›¾
â”œâ”€â”€ Libraries/
â”‚   â”œâ”€â”€ CultivateMethodAsset.cs     # ä¿®ç‚¼æ–¹å¼èµ„æºå®šä¹‰
â”‚   â””â”€â”€ CultivateMethodLibrary.cs   # ä¿®ç‚¼æ–¹å¼åº“ï¼ˆAssetLibraryï¼‰
â”œâ”€â”€ Systems/
â”‚   â””â”€â”€ Logic/
â”‚       â””â”€â”€ ContinuousCultivateSystem.cs # æŒç»­ä¿®ç‚¼ç³»ç»Ÿï¼ˆå›½è¿ç­‰ï¼‰
â”œâ”€â”€ Behaviours/
â”‚   â”œâ”€â”€ BehChooseCultibook.cs       # é€‰æ‹©åŠŸæ³•è¡Œä¸º
â”‚   â”œâ”€â”€ BehStudyCultibook.cs        # ç ”ä¹ åŠŸæ³•è¡Œä¸º
â”‚   â”œâ”€â”€ BehSwitchCultibook.cs       # è½¬ä¿®åŠŸæ³•è¡Œä¸º
â”‚   â”œâ”€â”€ BehTeachCultibook.cs        # ä¼ æˆåŠŸæ³•è¡Œä¸º
â”‚   â””â”€â”€ Conditions/
â”‚       â”œâ”€â”€ CondHasMainCultibook.cs
â”‚       â”œâ”€â”€ CondNeedStudyCultibook.cs
â”‚       â”œâ”€â”€ CondCanSwitchCultibook.cs
â”‚       â””â”€â”€ CondCultivateMethod.cs
â”œâ”€â”€ Extensions/
â”‚   â””â”€â”€ ActorExtendTools.cs         # åŠŸæ³•ç›¸å…³æ‰©å±•æ–¹æ³•ï¼ˆå·²åŒ…å«ï¼‰
â”œâ”€â”€ CultivateMethods.cs             # ä¿®ç‚¼æ–¹å¼é›†åˆï¼ˆExtendLibraryï¼Œè‡ªåŠ¨æ³¨å†Œï¼‰
â””â”€â”€ CultivateMethodTriggers.cs      # ä¿®ç‚¼æ–¹å¼è§¦å‘å™¨ï¼ˆè¢«åŠ¨è§¦å‘é›†æˆï¼‰

Source/Content/UI/
â””â”€â”€ CreatureInfoPages/
    â””â”€â”€ CultibookPage.cs            # åŠŸæ³•é¡µé¢ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰

Content/
â””â”€â”€ Cultibooks/
    â””â”€â”€ Cultibooks.json             # åŠŸæ³•é…ç½®

Locales/
â””â”€â”€ cultibooks.csv                  # åŠŸæ³•æœ¬åœ°åŒ–
```

### 9.3 LLMåŠŸæ³•ç”Ÿæˆæ–¹æ¡ˆ

**é…ç½®å¼€å…³**
- `default_config.json` â†’ `AIGCSettings.ENABLE_CULTIBOOK_LLM`ï¼Œé»˜è®¤å…³é—­ï¼Œé¿å…æ—  API Key æ—¶é˜»å¡ã€‚
- åªæœ‰åœ¨ BaseURL/APIKey/Model å‡å¡«å†™ä¸”å¼€å…³å¼€å¯çš„æƒ…å†µä¸‹æ‰ä¼šè¿›å…¥ LLM æµç¨‹ã€‚

**è°ƒç”¨æµç¨‹**
1. `BookManagerTools.CreateNewCultibook` é¦–å…ˆæ£€æŸ¥é…ç½®ï¼Œè‹¥å¼€å¯åˆ™æ”¶é›†è§’è‰²ä¿¡æ¯ï¼ˆçµæ ¹ã€å¢ƒç•Œã€åŠŸæ³•ã€æŠ€èƒ½ï¼‰ã€‚
2. `CultibookLLMGenerator` æ„é€ æç¤ºè¯ï¼šåŒ…å«å¯ç”¨çš„å±æ€§åˆ—è¡¨ã€ä¿®ç‚¼æ–¹å¼åˆ—è¡¨ã€å·²çŸ¥æŠ€èƒ½ï¼ˆé™„çœŸå® `SkillEntityAssetID`ï¼‰ã€è§’è‰²èƒŒæ™¯ç­‰ã€‚
3. é€šè¿‡ `Manager.RequestResponseContent` è¯·æ±‚ LLMï¼Œè¦æ±‚è¾“å‡ºå›ºå®š JSONï¼š
   ```json
   {
     "name": "string",
     "description": "string",
     "cultivate_method_id": "string",
     "min_level": 0,
     "max_level": 0,
     "element_requirement": { "iron": 0, ... },
     "stats": [{ "id": "damage", "value": 0 }],
     "skill_pool": [{ "skill_id": "Skill.Fireball", "chance": 0.05, "mastery_threshold": 30, "level_requirement": 5 }],
     "tags": { "conflict": [], "synergy": [] }
   }
   ```
4. è§£æç»“æœï¼Œæ ¡éªŒå­—æ®µåˆæ³•æ€§ï¼ˆå…ƒç´ /å¢ƒç•Œ/æ¦‚ç‡å…¨éƒ¨ clampï¼‰ã€‚è‹¥æŸå­—æ®µç¼ºå¤±ï¼Œåˆ™å›é€€è‡³æ—§çš„éšæœºç”Ÿæˆé€»è¾‘ã€‚
5. æ ¹æ®è“å›¾ç”Ÿæˆ `CultibookAsset`ï¼Œä¿å­˜åˆ° `CultibookLibrary` å¹¶å†™å› `Book`ã€‚

**å›é€€ç­–ç•¥**
- LLM è¯·æ±‚å¤±è´¥ã€è§£æå¤±è´¥æˆ–ç”Ÿæˆå†…å®¹ä¸ºç©º â†’ è‡ªåŠ¨å›åˆ°åŸæœ‰çš„ç»Ÿè®¡åˆ†å¸ƒé€»è¾‘ã€‚
- SkillPool è‹¥å¼•ç”¨äº†æœªçŸ¥æŠ€èƒ½ â†’ è‡ªåŠ¨è¿‡æ»¤ï¼Œä¸è¶³æ—¶ç”±é»˜è®¤é€»è¾‘è¡¥è¶³ã€‚

---

## å¼€å‘TODO

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¡†æ¶ (é¢„è®¡1å‘¨)

- [x] **T1.1** æ‰©å±• `CultibookAsset` æ•°æ®ç»“æ„ âœ…
  - [x] æ·»åŠ  Description å­—æ®µ
  - [x] æ·»åŠ  ElementRequirement å­—æ®µ
  - [x] æ·»åŠ  ElementAffinityThreshold å­—æ®µ
  - [x] æ·»åŠ  MinLevel/MaxLevel å¢ƒç•Œé™åˆ¶å­—æ®µ
  - [x] æ·»åŠ  CultivateMethodId å­—æ®µ
  - [x] æ·»åŠ  SkillPool å­—æ®µ
  - [x] æ·»åŠ  ConflictTags/SynergyTags å†²çª/ååŒæ ‡ç­¾å­—æ®µ

- [x] **T1.1.1** åˆ›å»º `ElementRequirement` ç»“æ„ä½“ âœ…
  - [x] å®ç°æ‰€æœ‰äº”è¡Œé˜´é˜³å…ƒç´ å­—æ®µ
  - [x] å®ç° `Check()` æ–¹æ³•ï¼ˆæ£€æŸ¥çµæ ¹æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼‰
  - [x] å®ç° `GetAffinity()` æ–¹æ³•ï¼ˆè®¡ç®—å¥‘åˆåº¦ï¼‰

- [x] **T1.1.2** åˆ›å»º `SkillPoolEntry` ç»“æ„ä½“ âœ…
  - [x] å®ç° SkillEntityAssetId å­—æ®µ
  - [x] å®ç° BaseChance å­—æ®µ
  - [x] å®ç° MasteryThreshold å­—æ®µ
  - [x] å®ç° LevelRequirement å­—æ®µ

- [x] **T1.2** åˆ›å»º `ActorCultibookState` ç»„ä»¶ âœ…
  - [x] å®ç°ä¸»ä¿®åŠŸæ³•ç®¡ç†
  - [x] å®ç°æŒæ¡ç¨‹åº¦ç®¡ç†
  - [x] å®ç°æ³•æœ¯é¢†æ‚Ÿè¿›åº¦ç®¡ç†

- [x] **T1.3** æ‰©å±• ActorExtend âœ…
  - [x] å®ç° `GetMainCultibook()` æ–¹æ³•
  - [x] å®ç° `SetMainCultibook()` æ–¹æ³•
  - [x] å®ç° `GetMainCultibookMastery()` æ–¹æ³•
  - [x] å®ç° `AddMainCultibookMastery()` æ–¹æ³•
  - [x] å®ç° `TrySwitchMainCultibook()` æ–¹æ³•
  - [x] å®ç° `CalculateSwitchSuccessRate()` è¾…åŠ©æ–¹æ³•
  - [x] å®ç° `TryComprehendSkill()` æ–¹æ³•
  - [x] å®ç° `LearnSkillFromCultibook()` è¾…åŠ©æ–¹æ³•
  - [x] å®ç° `HasSkill()` è¾…åŠ©æ–¹æ³•

- [x] **T1.4** ä¿®æ”¹ç°æœ‰åŠŸæ³•å­¦ä¹ é€»è¾‘ âœ…
  - [x] åŒºåˆ†"è®¾ä¸ºä¸»ä¿®"å’Œ"äº†è§£"
    - [x] å¦‚æœæ²¡æœ‰ä¸»ä¿®åŠŸæ³•ï¼Œæ–°å­¦ä¹ çš„åŠŸæ³•è®¾ä¸ºä¸»ä¿®ï¼ˆåˆå§‹æŒæ¡1%ï¼‰
    - [x] å¦‚æœå·²æœ‰ä¸»ä¿®ï¼Œæ–°å­¦ä¹ çš„åŠŸæ³•æ·»åŠ ä¸ºäº†è§£ï¼ˆäº†è§£ç¨‹åº¦ä¸Šé™50%ï¼‰
  - [x] ä¿®æ”¹ `BookTypes.LearnCultibook` å®ç°ä¸Šè¿°é€»è¾‘
  - [x] ä¿®æ”¹å±æ€§åŠ æˆé€»è¾‘ï¼ˆä»…ä¸»ä¿®ç”Ÿæ•ˆï¼‰
    - [x] ä»…åº”ç”¨ä¸»ä¿®åŠŸæ³•çš„ `FinalStats`
    - [x] æ ¹æ®ä¸»ä¿®æŒæ¡ç¨‹åº¦è®¡ç®—åŠ æˆæ¯”ä¾‹

### é˜¶æ®µäºŒï¼šä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ (é¢„è®¡1.5å‘¨)

- [x] **T2.1** åˆ›å»ºä¿®ç‚¼æ–¹å¼Assetæ¡†æ¶ âœ…
  - [x] åˆ›å»º `CultivateMethodAsset` ç±»ï¼ˆå«å§”æ‰˜å®šä¹‰ï¼‰
  - [x] åˆ›å»º `CultivateMethods` åº“ï¼ˆExtendLibraryï¼‰
  - [x] å®šä¹‰ `CultivateTriggerType` æšä¸¾ï¼ˆActive/Passive/Continuousï¼‰

- [x] **T2.2** å®ç°ä¸»åŠ¨ä¿®ç‚¼æ–¹å¼ï¼ˆActiveï¼‰- åŸºç¡€æ¡†æ¶ âœ…
  - [x] Standard - æ ‡å‡†é—­å…³ä¿®ç‚¼
    - [x] CanCultivate: æ£€æŸ¥æ˜¯å¦æœ‰ä¿®ä»™çŠ¶æ€
    - [x] GetEfficiency: æ ¹æ®çµæ ¹å¼ºåº¦è®¡ç®—æ•ˆç‡
    - [x] GetBehaviourJobId: è¿”å›å¯¹åº”çš„è¡Œä¸ºä»»åŠ¡IDï¼ˆæœ‰ä½æ‰€ç”¨XianCultivatorï¼Œå¦åˆ™ç”¨PlantXianCultivatorï¼‰
  - [x] WaterMeditation - æ°´ä¸­ä¿®ç‚¼ âœ…
    - [x] CanCultivate: æ£€æŸ¥æ˜¯å¦åœ¨æ°´ä¸­
    - [x] GetEfficiency: æ°´ä¸­1.5xï¼Œä¸æ°´ç³»çµæ ¹ç›¸å…³
    - [x] GetBehaviourJobId: è¿”å›æ°´ä¸­ä¿®ç‚¼ä»»åŠ¡ID
  - [ ] MountainAbsorb - å±±å·…ä¿®ç‚¼ï¼ˆå¾…å®ç°ï¼‰
  - [ ] ForestCommunion - æ—ä¸­ä¿®ç‚¼ï¼ˆå¾…å®ç°ï¼‰

- [x] **T2.3** å®ç°è¢«åŠ¨ä¿®ç‚¼æ–¹å¼ï¼ˆPassiveï¼‰âœ…
  - [x] è¢«åŠ¨è§¦å‘äº‹ä»¶æ¡†æ¶ âœ…
    - [x] å®ç° OnKill è§¦å‘å¤„ç†
    - [x] å®ç° OnAttack è§¦å‘å¤„ç†
    - [x] å®ç° OnBeAttacked è§¦å‘å¤„ç†
  - [x] BattleCultivate - æˆ˜æ–—ä¿®ç‚¼ âœ…
    - [x] PassiveTriggerEvents: æ·»åŠ  OnAttack, OnBeAttacked
    - [x] CanCultivate: æ£€æŸ¥æ˜¯å¦æœ‰ä¿®ä»™çŠ¶æ€
    - [x] GetEfficiency: åŸºç¡€æ•ˆç‡1.0ï¼ˆå¯åç»­æ‰©å±•ï¼‰
    - [ ] OnSideEffect: å¢åŠ æˆ˜æ–—ç»éªŒï¼ˆå¾…åç»­æ‰©å±•ï¼‰
  - [x] KillAbsorb - æ€æˆ®å¸æ”¶ âœ…
    - [x] PassiveTriggerEvents: æ·»åŠ  OnKill
    - [x] CanCultivate: æ£€æŸ¥æ˜¯å¦æœ‰ä¿®ä»™çŠ¶æ€
    - [x] GetEfficiency: åŸºç¡€æ•ˆç‡1.0ï¼ˆå¯åç»­æ‰©å±•ï¼‰
    - [ ] OnSideEffect: ç§¯ç´¯æ€ä¸š/karmaï¼ˆå¾…åç»­æ‰©å±•ï¼‰
  - [ ] MeritAccumulate - åŠŸå¾·ä¿®ç‚¼ï¼ˆAssetå¾…å®ç°ï¼‰
    - [ ] PassiveTriggerEvents: æ·»åŠ  OnGoodDeed
    - [ ] CanCultivate: æ£€æŸ¥æ˜¯å¦æœ‰åŠŸå¾·ï¼ˆkarma >= 0ï¼‰
    - [ ] GetEfficiency: æ ¹æ®åŠŸå¾·å€¼è®¡ç®—æ•ˆç‡
    - [ ] OnSideEffect: å¢åŠ åŠŸå¾·å€¼

- [x] **T2.4** å®ç°æŒç»­ä¿®ç‚¼æ–¹å¼ï¼ˆContinuousï¼‰âœ…
  - [x] KingdomFortune - å›½è¿ä¿®ç‚¼ âœ…
    - [x] CanCultivate: éœ€è¦ä¸»ä¿®è€…ä¸ºå›½ç‹æˆ–åŸä¸»
    - [x] GetEfficiency: å›½ç‹1.0ï¼ŒåŸä¸»0.5
    - [ ] OnSideEffect: å¯é€‰çš„å›½å®¶æ°”è¿å½±å“ï¼ˆå¾…åç»­æ‰©å±•ï¼‰
  - [x] åˆ›å»º `ContinuousCultivateSystem` ç³»ç»Ÿ âœ…
    - [x] åœ¨ç³»ç»Ÿä¸­å®ç°æŒç»­ä¿®ç‚¼çš„çµåŠ›æ”¶ç›Šè®¡ç®—
    - [x] åˆ›å»º `ContinuousCultivateTag` æ ‡è®°ç»„ä»¶ç”¨äºæ€§èƒ½ä¼˜åŒ–
    - [x] åœ¨ç³»ç»Ÿæ„é€ å‡½æ•°ä¸­æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ŒåªæŸ¥è¯¢æœ‰æ ‡è®°çš„å•ä½
    - [x] åœ¨ `SetMainCultibook` ä¸­è‡ªåŠ¨ç®¡ç†æ ‡è®°

- [x] **T2.5** ä¿®ç‚¼è§¦å‘é›†æˆ âœ…
  - [x] åˆ›å»º `CultivateMethodTriggers` ç±» âœ…
  - [x] æ³¨å†Œ OnKill è§¦å‘ âœ…
    - [x] å®ç° `OnKillTrigger` æ–¹æ³•
    - [x] æ ¹æ®ç›®æ ‡å¼ºåº¦è®¡ç®—çµåŠ›æ”¶ç›Š
  - [x] æ³¨å†Œ OnAttack/OnBeAttacked è§¦å‘ âœ…
    - [x] åœ¨ `ActorExtend` ä¸­æ·»åŠ  `RegisterActionOnBeAttacked` æ–¹æ³•
    - [x] å®ç° `OnAttackTrigger` æ–¹æ³•ï¼ˆæ”»å‡»æ—¶è§¦å‘ï¼‰
    - [x] å®ç° `OnBeAttackedTrigger` æ–¹æ³•ï¼ˆè¢«æ”»å‡»æ—¶è§¦å‘ï¼‰
  - [ ] æ³¨å†Œ OnGoodDeed è§¦å‘ï¼ˆå¾…å®ç°ï¼‰
  - [ ] åˆ›å»ºé€šç”¨ `BehGenericCultivate` è¡Œä¸ºï¼ˆå¾…å®ç°ï¼‰

### é˜¶æ®µä¸‰ï¼šæ³•æœ¯æ± ä¸é¢†æ‚Ÿ (é¢„è®¡1å‘¨)

- [x] **T3.1** æ³•æœ¯æ± ç³»ç»Ÿï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
  - [x] å®ç° `SkillPoolEntry` æ•°æ®ç»“æ„ âœ…
  - [ ] å®ç°æ³•æœ¯é¢†æ‚Ÿæ¦‚ç‡è®¡ç®—
  - [ ] å®ç°é¢†æ‚Ÿåˆ¤å®šé€»è¾‘

- [ ] **T3.2** æ³•æœ¯é¢†æ‚Ÿè§¦å‘
  - [ ] ä¿®ç‚¼å®Œæˆåè§¦å‘åˆ¤å®š
  - [ ] æŒæ¡ç¨‹åº¦çªç ´æ—¶è§¦å‘åˆ¤å®š
  - [ ] å®ç°é¢†æ‚ŸåŠ¨ç”»/é€šçŸ¥

- [ ] **T3.3** é…ç½®æ³•æœ¯æ± 
  - [ ] ä¸ºç°æœ‰æ³•æœ¯é…ç½®åŠŸæ³•å½’å±
  - [ ] åˆ›å»ºåŠŸæ³•-æ³•æœ¯é…ç½®æ–‡ä»¶

### é˜¶æ®µå››ï¼šAIè¡Œä¸ºå®Œå–„ (é¢„è®¡1å‘¨)

- [ ] **T4.1** åŠŸæ³•é€‰æ‹©AI
  - [ ] å®ç° `BehChooseCultibook`
  - [ ] å®ç°åŠŸæ³•è¯„ä¼°ç®—æ³•ï¼ˆå“é˜¶ã€å¥‘åˆåº¦ç­‰ï¼‰

- [x] **T4.2** è½¬ä¿®AI
  - [x] å®ç° `BehSwitchCultibook`
  - [x] å®ç°è½¬ä¿®æ—¶æœºåˆ¤æ–­
  - [x] å®ç°è½¬ä¿®é£é™©è¯„ä¼°

- [ ] **T4.3** ä¼ æ‰¿AI
  - [ ] å®ç° `BehTeachCultibook`
  - [ ] å®ç°å¸ˆæ‰¿å…³ç³»å»ºç«‹
  - [ ] å®—é—¨åŠŸæ³•ä¼ æˆ

- [x] **T4.4** æ”¹è¿›AI
  - [x] å®ç° `BehImproveCultibook`

### é˜¶æ®µäº”ï¼šUIä¸æœ¬åœ°åŒ– (é¢„è®¡0.5å‘¨)

- [x] **T5.1** æ‰©å±•åŠŸæ³•ä¿¡æ¯é¡µé¢ âœ…
  - [x] æ˜¾ç¤ºä¸»ä¿®/äº†è§£åŒºåˆ†
  - [x] æ˜¾ç¤ºæŒæ¡ç¨‹åº¦è¿›åº¦æ¡ï¼ˆæ–‡æœ¬å½¢å¼ï¼‰
  - [x] æ˜¾ç¤ºä¿®ç‚¼æ–¹å¼ï¼ˆåç§°å’Œæè¿°ï¼‰
  - [x] æ˜¾ç¤ºå¯é¢†æ‚Ÿæ³•æœ¯ï¼ˆåŒ…å«å·²é¢†æ‚ŸçŠ¶æ€ï¼‰

- [x] **T5.2** åŠŸæ³•ä¹¦Tooltip âœ…
  - [x] æ˜¾ç¤ºå®Œæ•´åŠŸæ³•ä¿¡æ¯ï¼ˆåç§°ã€å“é˜¶ã€æè¿°ï¼‰
  - [x] æ˜¾ç¤ºçµæ ¹éœ€æ±‚ï¼ˆæ‰€æœ‰éé›¶å…ƒç´ éœ€æ±‚ï¼‰
  - [x] æ˜¾ç¤ºå¢ƒç•Œè¦æ±‚
  - [x] æ˜¾ç¤ºä¿®ç‚¼æ–¹å¼ï¼ˆåç§°å’Œæè¿°ï¼‰
  - [x] æ˜¾ç¤ºæ»¡æŒæ¡å±æ€§åŠ æˆ
  - [x] æ˜¾ç¤ºæ³•æœ¯æ± ï¼ˆåŒ…å«æŒæ¡è¦æ±‚å’Œå¢ƒç•Œè¦æ±‚ï¼‰
  - [x] æ˜¾ç¤ºæŠ„å½•è€…ä¿¡æ¯

- [x] **T5.3** æœ¬åœ°åŒ– âœ…
  - [x] å·²åœ¨ `books.csv` ä¸­æ·»åŠ ä¿®ç‚¼æ–¹å¼åç§°å’Œæè¿°
    - [x] Standard - æ ‡å‡†é—­å…³
    - [x] WaterMeditation - æ°´ä¸­ä¿®ç‚¼
    - [x] BattleCultivate - æˆ˜æ–—ä¿®ç‚¼
    - [x] KillAbsorb - æ€æˆ®å¸æ”¶
    - [x] KingdomFortune - å›½è¿ä¿®ç‚¼
  - [ ] æ·»åŠ æ›´å¤šUIæ–‡æœ¬æœ¬åœ°åŒ–ï¼ˆå¾…å®Œå–„ï¼‰

### é˜¶æ®µå…­ï¼šå†…å®¹å¡«å…… (é¢„è®¡1å‘¨)

- [ ] **T6.1** åˆ›å»ºåŸºç¡€åŠŸæ³•
  - [ ] 5ä¸ªäººçº§åŠŸæ³•ï¼ˆæ¯ç§çµæ ¹1ä¸ªï¼‰
  - [ ] 3ä¸ªåœ°çº§åŠŸæ³•
  - [ ] 2ä¸ªå¤©çº§åŠŸæ³•
  - [ ] 1ä¸ªä»™çº§åŠŸæ³•

- [ ] **T6.2** é…ç½®åŠŸæ³•æ³•æœ¯æ± 
  - [ ] å…³è”ç°æœ‰æ³•æœ¯
  - [ ] å¹³è¡¡é¢†æ‚Ÿæ¦‚ç‡

- [ ] **T6.3** åˆ›å»ºç‰¹æ®ŠåŠŸæ³•
  - [ ] 1-2ä¸ªé­”é“åŠŸæ³•
  - [ ] 1ä¸ªå¸é“åŠŸæ³•
  - [ ] 1ä¸ªä½›é“åŠŸæ³•

- [x] **T6.4** LLM åŠŸæ³•ç”Ÿæˆ
  - [x] æ–°å¢é…ç½®å¼€å…³ä¸ `CultibookLLMGenerator`
  - [x] è§„èŒƒæç¤ºè¯ä¸ JSON Schema
  - [x] `BookManagerTools` é›†æˆä¸å›é€€é€»è¾‘

### é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸å¹³è¡¡ (é¢„è®¡0.5å‘¨)

- [ ] **T7.1** åŠŸèƒ½æµ‹è¯•
  - [ ] æµ‹è¯•åŠŸæ³•å­¦ä¹ æµç¨‹
  - [ ] æµ‹è¯•è½¬ä¿®æœºåˆ¶
  - [ ] æµ‹è¯•å„ä¿®ç‚¼æ–¹å¼
  - [ ] æµ‹è¯•æ³•æœ¯é¢†æ‚Ÿ

- [ ] **T7.2** å¹³è¡¡æ€§è°ƒæ•´
  - [ ] è°ƒæ•´æŒæ¡ç¨‹åº¦å¢é•¿é€Ÿåº¦
  - [ ] è°ƒæ•´è½¬ä¿®æˆåŠŸç‡
  - [ ] è°ƒæ•´æ³•æœ¯é¢†æ‚Ÿæ¦‚ç‡
  - [ ] è°ƒæ•´å±æ€§åŠ æˆæ•°å€¼

- [ ] **T7.3** AIè¡Œä¸ºæµ‹è¯•
  - [ ] æµ‹è¯•åŠŸæ³•é€‰æ‹©åˆç†æ€§
  - [ ] æµ‹è¯•ä¿®ç‚¼è¡Œä¸ºæ­£ç¡®æ€§
  - [ ] æµ‹è¯•ä¼ æ‰¿è¡Œä¸º

---

## æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|-----|------|---------|
| é˜¶æ®µä¸€ | æ ¸å¿ƒæ¡†æ¶ | 1å‘¨ |
| é˜¶æ®µäºŒ | ä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ | 1.5å‘¨ |
| é˜¶æ®µä¸‰ | æ³•æœ¯æ± ä¸é¢†æ‚Ÿ | 1å‘¨ |
| é˜¶æ®µå›› | AIè¡Œä¸ºå®Œå–„ | 1å‘¨ |
| é˜¶æ®µäº” | UIä¸æœ¬åœ°åŒ– | 0.5å‘¨ |
| é˜¶æ®µå…­ | å†…å®¹å¡«å…… | 1å‘¨ |
| é˜¶æ®µä¸ƒ | æµ‹è¯•ä¸å¹³è¡¡ | 0.5å‘¨ |
| **æ€»è®¡** | | **6.5å‘¨** |

---

## é™„å½•

### A. é¢„è®¾åŠŸæ³•åˆ—è¡¨

| åç§° | å“é˜¶ | çµæ ¹ | ä¿®ç‚¼æ–¹å¼ | æè¿° |
|-----|-----|-----|---------|------|
| åŸºç¡€å…»æ°”æœ¯ | äººçº§ | æ—  | æ ‡å‡† | æœ€åŸºç¡€çš„ä¿®ç‚¼åŠŸæ³• |
| æ°´çµè¯€ | äººçº§ | æ°´ | æ°´ä¸­ä¿®ç‚¼ | æ°´ç³»å…¥é—¨åŠŸæ³• |
| çƒˆç«ç„šå¿ƒè¯€ | äººçº§ | ç« | æˆ˜æ–—ä¿®ç‚¼ | ç«ç³»å…¥é—¨åŠŸæ³• |
| ç„æœ¨é•¿ç”Ÿè¯€ | äººçº§ | æœ¨ | æ—ä¸­ä¿®ç‚¼ | æœ¨ç³»å…¥é—¨åŠŸæ³• |
| é‡‘åˆšä¸åç» | äººçº§ | é‡‘ | æˆ˜æ–—ä¿®ç‚¼ | é‡‘ç³»å…¥é—¨åŠŸæ³• |
| åšåœŸçœŸç» | äººçº§ | åœŸ | å±±å·…ä¿®ç‚¼ | åœŸç³»å…¥é—¨åŠŸæ³• |
| ä¹å¹½é­”åŠŸ | åœ°çº§ | é˜´ | æ€æˆ®å¸æ”¶ | é­”é“åŠŸæ³• |
| å¤ªç„çœŸç» | å¤©çº§ | é‡‘ | å±±å·…ä¿®ç‚¼ | é‡‘ç³»é«˜é˜¶åŠŸæ³• |
| è‹å¤©å¸ç» | å¤©çº§ | æ—  | å›½è¿ä¿®ç‚¼ | å¸é“åŠŸæ³• |
| æ··å…ƒæ— æåŠŸ | ä»™çº§ | æ—  | æ ‡å‡† | é¡¶çº§é€šç”¨åŠŸæ³• |

### B. ä¿®ç‚¼æ•ˆç‡å…¬å¼

```
æœ€ç»ˆæ•ˆç‡ = åŸºç¡€æ•ˆç‡ Ã— æ–¹å¼ç³»æ•° Ã— å¥‘åˆåº¦ Ã— å¢ƒç•Œç³»æ•° Ã— å¤©èµ‹ç³»æ•°

åŸºç¡€æ•ˆç‡ = 1.0
æ–¹å¼ç³»æ•° = ä¿®ç‚¼æ–¹å¼Asset.EfficiencyCalculator(actor)
å¥‘åˆåº¦ = åŠŸæ³•çµæ ¹éœ€æ±‚.GetAffinity(è§’è‰²çµæ ¹)
å¢ƒç•Œç³»æ•° = 1 + (å½“å‰å¢ƒç•Œ - åŠŸæ³•æœ€ä½å¢ƒç•Œ) Ã— 0.1
å¤©èµ‹ç³»æ•° = 1 + æœ‰ä¿®ç‚¼å¤©èµ‹ç‰¹è´¨ Ã— 0.3
```

### C. è½¬ä¿®æˆåŠŸç‡å…¬å¼

```
æˆåŠŸç‡ = åŸºç¡€æˆåŠŸç‡ + æ™ºåŠ›åŠ æˆ + å¥‘åˆåº¦åŠ æˆ - å¢ƒç•Œæƒ©ç½š

åŸºç¡€æˆåŠŸç‡ = 0.7
æ™ºåŠ›åŠ æˆ = min(æ™ºåŠ› / 100 Ã— 0.2, 0.2)
å¥‘åˆåº¦åŠ æˆ = æ–°åŠŸæ³•å¥‘åˆåº¦ Ã— 0.1
å¢ƒç•Œæƒ©ç½š = max(0, (å½“å‰å¢ƒç•Œ - 3) Ã— 0.05)  // é‡‘ä¸¹åè½¬ä¿®æ›´éš¾
```

---

## å¾…å®Œå–„ç»†èŠ‚ä¸ä»£ç TODO

### ä»£ç ä¸­çš„TODOé¡¹

ä»¥ä¸‹æ˜¯ä»ä»£ç å®ç°ä¸­æ”¶é›†åˆ°çš„å¾…å®Œå–„é¡¹ç›®ï¼š

#### è½¬ä¿®å¤±è´¥çš„é¢å¤–æƒ©ç½š
**ä½ç½®**: `Source/Content/Extensions/ActorExtendTools.cs:213`  
**å½“å‰çŠ¶æ€**: è½¬ä¿®å¤±è´¥æ—¶ä»…æŸå¤±50%çµåŠ›  
**å¾…å®Œå–„å†…å®¹**:
- [ ] ä¸¥é‡è½¬ä¿®å¤±è´¥å¯èƒ½å¯¼è‡´å¢ƒç•Œæ‰è½
- [ ] æ·»åŠ å¿ƒé­”/è´Ÿé¢çŠ¶æ€æ•ˆæœ
- [ ] æ ¹æ®å¤±è´¥ä¸¥é‡ç¨‹åº¦åˆ†çº§æƒ©ç½š
- [ ] æ·»åŠ æ¢å¤æœŸï¼ˆçŸ­æ—¶é—´å†…æ— æ³•å†æ¬¡è½¬ä¿®ï¼‰

**å»ºè®®å®ç°**:
```csharp
// è½¬ä¿®å¤±è´¥æ—¶çš„é¢å¤–æƒ©ç½š
if (!Randy.randomChance(successRate))
{
    ref var xian = ref ae.GetCultisys<Xian>();
    xian.wakan *= 0.5f;
    
    // TODO: é¢å¤–çš„æƒ©ç½š
    // - ä¸¥é‡å¤±è´¥å¯èƒ½æ‰è½å¢ƒç•Œ
    // - æ·»åŠ å¿ƒé­”çŠ¶æ€ï¼ˆè´Ÿé¢buffï¼‰
    // - è®¾ç½®è½¬ä¿®å†·å´æ—¶é—´
}
```

#### æŒç»­ä¿®ç‚¼ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–
**ä½ç½®**: `Source/Content/Systems/Logic/ContinuousCultivateSystem.cs`  
**å½“å‰çŠ¶æ€**: å·²åˆ›å»ºæ ‡è®°ç»„ä»¶ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½  
**å·²å®Œæˆå†…å®¹**:
- [x] åˆ›å»º `ContinuousCultivateTag` æ ‡è®°ç»„ä»¶
- [x] åœ¨ç³»ç»Ÿæ„é€ å‡½æ•°ä¸­æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ŒåªæŸ¥è¯¢æœ‰æ ‡è®°çš„å•ä½
- [x] åœ¨ `SetMainCultibook` ä¸­è‡ªåŠ¨ç®¡ç†æ ‡è®°ï¼ˆè®¾ç½®/åˆ‡æ¢ä¸»ä¿®åŠŸæ³•æ—¶è‡ªåŠ¨æ·»åŠ /ç§»é™¤ï¼‰
- [x] åœ¨ `TrySwitchMainCultibook` ä¸­è‡ªåŠ¨ç®¡ç†æ ‡è®°

**æ€§èƒ½ä¼˜åŒ–æ•ˆæœ**:
- æŸ¥è¯¢é‡å¤§å¹…å‡å°‘ï¼šä»…æŸ¥è¯¢æœ‰æŒç»­ä¿®ç‚¼æ ‡è®°çš„å•ä½
- é¢„æœŸæ€§èƒ½æå‡ï¼šå¦‚æœåªæœ‰10%çš„å•ä½ä½¿ç”¨æŒç»­ä¿®ç‚¼ï¼ŒæŸ¥è¯¢é‡å‡å°‘çº¦90%

---

## å®ç°è¿›åº¦æ€»ç»“

### å·²å®Œæˆé˜¶æ®µ

- âœ… **é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¡†æ¶** - 100% å®Œæˆ
  - æ‰€æœ‰æ ¸å¿ƒæ•°æ®ç»“æ„å·²å®ç°
  - ActorExtend æ‰©å±•æ–¹æ³•å·²å®Œæˆ
  - åŠŸæ³•å­¦ä¹ é€»è¾‘å·²å®ç°

- âœ… **é˜¶æ®µäºŒï¼šä¿®ç‚¼æ–¹å¼ç³»ç»Ÿ** - 90% å®Œæˆ
  - æ¡†æ¶å’Œä¸»è¦ä¿®ç‚¼æ–¹å¼å·²å®ç°
  - Standardã€WaterMeditationã€BattleCultivateã€KillAbsorbã€KingdomFortune å·²å®ç°
  - è¢«åŠ¨è§¦å‘ç³»ç»Ÿå·²é›†æˆ
  - æŒç»­ä¿®ç‚¼ç³»ç»Ÿå·²ä¼˜åŒ–

- âš ï¸ **é˜¶æ®µä¸‰ï¼šæ³•æœ¯æ± ä¸é¢†æ‚Ÿ** - 30% å®Œæˆ
  - æ•°æ®ç»“æ„å·²å®ç°
  - é¢†æ‚Ÿé€»è¾‘å¾…å®ç°

- âœ… **é˜¶æ®µäº”ï¼šUIä¸æœ¬åœ°åŒ–** - 95% å®Œæˆ
  - CultibookPage å·²å®Œæˆ
  - CultibookTooltip å·²å®Œæˆ
  - ä¸»è¦æœ¬åœ°åŒ–å·²å®Œæˆ

### å¾…å®Œæˆå·¥ä½œ

- é˜¶æ®µä¸‰ï¼šæ³•æœ¯é¢†æ‚Ÿè§¦å‘å’Œåˆ¤å®šé€»è¾‘
- é˜¶æ®µå››ï¼šAIè¡Œä¸ºå®Œå–„
- é˜¶æ®µå…­ï¼šå†…å®¹å¡«å……
- é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸å¹³è¡¡

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ¯æ¬¡åŠŸæ³•ç³»ç»Ÿæ›´æ–°åæ›´æ–°æ­¤æ–‡æ¡£  
**ä¸‹æ¬¡å®¡æŸ¥**: å®Œæˆé˜¶æ®µä¸‰å

